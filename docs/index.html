<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="generator" content="TiddlyWiki" />
<meta name="tiddlywiki-version" content="5.1.14" />
<meta name="format-detection" content="telephone=no">
<link id="faviconLink" rel="shortcut icon" href="favicon.ico">
<title>My TiddlyWiki â€” a non-linear personal web notebook</title>
<div id="styleArea">
<style data-tiddler-title="$:/boot/boot.css" data-tiddler-type="text/css" type="text/css">/*
Basic styles used before we boot up the parsing engine
*/

/*
Error message and password prompt
*/

.tc-password-wrapper, .tc-error-form {
    font-family: sans-serif;
	z-index: 20000;
	position: fixed;
	text-align: center;
	width: 200px;
	top: 4em;
    left: 50%;
    margin-left: -144px; /* - width/2 - paddingHorz/2 - border */
	padding: 16px 16px 16px 16px;
	border-radius: 8px;
}

.tc-error-form {
	color: #fff;
	text-shadow: 0 1px 0 rgba(0, 0, 0, 0.5);
	background-color: rgb(255, 75, 75);
	border: 8px solid rgb(255, 0, 0);
	width: 480px;
    margin-left: -244px; /* - width/2 - paddingHorz/2 - border */
}

.tc-error-form div {
	padding-bottom: 1em;
}

.tc-error-prompt {
	color: #000;
	text-shadow: none;
}

.tc-password-wrapper {
	color: #000;
	text-shadow: 0 1px 0 rgba(255, 255, 255, 0.5);
	background-color: rgb(197, 235, 183);
	border: 8px solid rgb(164, 197, 152);
}

.tc-password-wrapper form {
	text-align: left;
}

.tc-password-wrapper h1 {
	font-size: 16px;
	line-height: 20px;
	padding-bottom: 16px;
}

.tc-password-wrapper input {
	width: 100%;
}
</style>
</div>
<style type="text/css">

/*

Original style from softwaremaniacs.org (c) Ivan Sagalaev <Maniac@SoftwareManiacs.Org>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  background: #f0f0f0;
  -webkit-text-size-adjust: none;
}

.hljs,
.hljs-subst,
.hljs-tag .hljs-title,
.nginx .hljs-title {
  color: black;
}

.hljs-string,
.hljs-title,
.hljs-constant,
.hljs-parent,
.hljs-tag .hljs-value,
.hljs-rule .hljs-value,
.hljs-preprocessor,
.hljs-pragma,
.hljs-name,
.haml .hljs-symbol,
.ruby .hljs-symbol,
.ruby .hljs-symbol .hljs-string,
.hljs-template_tag,
.django .hljs-variable,
.smalltalk .hljs-class,
.hljs-addition,
.hljs-flow,
.hljs-stream,
.bash .hljs-variable,
.pf .hljs-variable,
.apache .hljs-tag,
.apache .hljs-cbracket,
.tex .hljs-command,
.tex .hljs-special,
.erlang_repl .hljs-function_or_atom,
.asciidoc .hljs-header,
.markdown .hljs-header,
.coffeescript .hljs-attribute,
.tp .hljs-variable {
  color: #800;
}

.smartquote,
.hljs-comment,
.hljs-annotation,
.diff .hljs-header,
.hljs-chunk,
.asciidoc .hljs-blockquote,
.markdown .hljs-blockquote {
  color: #888;
}

.hljs-number,
.hljs-date,
.hljs-regexp,
.hljs-literal,
.hljs-hexcolor,
.smalltalk .hljs-symbol,
.smalltalk .hljs-char,
.go .hljs-constant,
.hljs-change,
.lasso .hljs-variable,
.makefile .hljs-variable,
.asciidoc .hljs-bullet,
.markdown .hljs-bullet,
.asciidoc .hljs-link_url,
.markdown .hljs-link_url {
  color: #080;
}

.hljs-label,
.ruby .hljs-string,
.hljs-decorator,
.hljs-filter .hljs-argument,
.hljs-localvars,
.hljs-array,
.hljs-attr_selector,
.hljs-important,
.hljs-pseudo,
.hljs-pi,
.haml .hljs-bullet,
.hljs-doctype,
.hljs-deletion,
.hljs-envvar,
.hljs-shebang,
.apache .hljs-sqbracket,
.nginx .hljs-built_in,
.tex .hljs-formula,
.erlang_repl .hljs-reserved,
.hljs-prompt,
.asciidoc .hljs-link_label,
.markdown .hljs-link_label,
.vhdl .hljs-attribute,
.clojure .hljs-attribute,
.asciidoc .hljs-attribute,
.lasso .hljs-attribute,
.coffeescript .hljs-property,
.hljs-phony {
  color: #88f;
}

.hljs-keyword,
.hljs-id,
.hljs-title,
.hljs-built_in,
.css .hljs-tag,
.hljs-doctag,
.smalltalk .hljs-class,
.hljs-winutils,
.bash .hljs-variable,
.pf .hljs-variable,
.apache .hljs-tag,
.hljs-type,
.hljs-typename,
.tex .hljs-command,
.asciidoc .hljs-strong,
.markdown .hljs-strong,
.hljs-request,
.hljs-status,
.tp .hljs-data,
.tp .hljs-io {
  font-weight: bold;
}

.asciidoc .hljs-emphasis,
.markdown .hljs-emphasis,
.tp .hljs-units {
  font-style: italic;
}

.nginx .hljs-built_in {
  font-weight: normal;
}

.coffeescript .javascript,
.javascript .xml,
.lasso .markup,
.tex .hljs-formula,
.xml .javascript,
.xml .vbscript,
.xml .css,
.xml .hljs-cdata {
  opacity: 0.5;
}


.hljs{display:block;overflow-x:auto;padding:.5em;color:#333;background:#f8f8f8;-webkit-text-size-adjust:none}.hljs-comment,.diff .hljs-header,.hljs-javadoc{color:#998;font-style:italic}.hljs-keyword,.css .rule .hljs-keyword,.hljs-winutils,.nginx .hljs-title,.hljs-subst,.hljs-request,.hljs-status{color:#333;font-weight:bold}.hljs-number,.hljs-hexcolor,.ruby .hljs-constant{color:teal}.hljs-string,.hljs-tag .hljs-value,.hljs-phpdoc,.hljs-dartdoc,.tex .hljs-formula{color:#d14}.hljs-title,.hljs-id,.scss .hljs-preprocessor{color:#900;font-weight:bold}.hljs-list .hljs-keyword,.hljs-subst{font-weight:normal}.hljs-class .hljs-title,.hljs-type,.vhdl .hljs-literal,.tex .hljs-command{color:#458;font-weight:bold}.hljs-tag,.hljs-tag .hljs-title,.hljs-rule .hljs-property,.django .hljs-tag .hljs-keyword{color:navy;font-weight:normal}.hljs-attribute,.hljs-variable,.lisp .hljs-body,.hljs-name{color:teal}.hljs-regexp{color:#009926}.hljs-symbol,.ruby .hljs-symbol .hljs-string,.lisp .hljs-keyword,.clojure .hljs-keyword,.scheme .hljs-keyword,.tex .hljs-special,.hljs-prompt{color:#990073}.hljs-built_in{color:#0086b3}.hljs-preprocessor,.hljs-pragma,.hljs-pi,.hljs-doctype,.hljs-shebang,.hljs-cdata{color:#999;font-weight:bold}.hljs-deletion{background:#fdd}.hljs-addition{background:#dfd}.diff .hljs-change{background:#0086b3}.hljs-chunk{color:#aaa}

.tc-sidebar-header {
	text-shadow: 0 1px 0 rgba(255,255,255, 0.8);
}.tc-tiddler-info {
	
  -webkit-box-shadow: inset 1px 2px 3px rgba(0,0,0,0.1);
     -moz-box-shadow: inset 1px 2px 3px rgba(0,0,0,0.1);
          box-shadow: inset 1px 2px 3px rgba(0,0,0,0.1);

}@media screen {
	.tc-tiddler-frame {
		
  -webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3);
     -moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3);
          box-shadow: 1px 1px 5px rgba(0, 0, 0, 0.3);

	}
}@media (max-width: 960px) {
	.tc-tiddler-frame {
		
  -webkit-box-shadow: none;
     -moz-box-shadow: none;
          box-shadow: none;

	}
}.tc-page-controls button svg, .tc-tiddler-controls button svg, .tc-topbar button svg {
	
  -webkit-transition: fill 150ms ease-in-out;
     -moz-transition: fill 150ms ease-in-out;
          transition: fill 150ms ease-in-out;

}.tc-tiddler-controls button.tc-selected,
.tc-page-controls button.tc-selected {
	
  -webkit-filter: drop-shadow(0px -1px 2px rgba(0,0,0,0.25));
     -moz-filter: drop-shadow(0px -1px 2px rgba(0,0,0,0.25));
          filter: drop-shadow(0px -1px 2px rgba(0,0,0,0.25));

}.tc-tiddler-frame input.tc-edit-texteditor {
	
  -webkit-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);
     -moz-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);
          box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);

}.tc-edit-tags {
	
  -webkit-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);
     -moz-box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);
          box-shadow: inset 0 1px 8px rgba(0, 0, 0, 0.15);

}.tc-tiddler-frame .tc-edit-tags input.tc-edit-texteditor {
	
  -webkit-box-shadow: none;
     -moz-box-shadow: none;
          box-shadow: none;

	border: none;
	outline: none;
}canvas.tc-edit-bitmapeditor  {
	
  -webkit-box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
     -moz-box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);
          box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.5);

}.tc-drop-down {
	border-radius: 4px;
	
  -webkit-box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
     -moz-box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
          box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);

}.tc-block-dropdown {
	border-radius: 4px;
	
  -webkit-box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
     -moz-box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);
          box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.5);

}.tc-modal {
	border-radius: 6px;
	
  -webkit-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
     -moz-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
          box-shadow: 0 3px 7px rgba(0,0,0,0.3);

}.tc-modal-footer {
	border-radius: 0 0 6px 6px;
	
  -webkit-box-shadow: inset 0 1px 0 #fff;
     -moz-box-shadow: inset 0 1px 0 #fff;
          box-shadow: inset 0 1px 0 #fff;
;
}.tc-alert {
	border-radius: 6px;
	
  -webkit-box-shadow: 0 3px 7px rgba(0,0,0,0.6);
     -moz-box-shadow: 0 3px 7px rgba(0,0,0,0.6);
          box-shadow: 0 3px 7px rgba(0,0,0,0.6);

}.tc-notification {
	border-radius: 6px;
	
  -webkit-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
     -moz-box-shadow: 0 3px 7px rgba(0,0,0,0.3);
          box-shadow: 0 3px 7px rgba(0,0,0,0.3);

	text-shadow: 0 1px 0 rgba(255,255,255, 0.8);
}.tc-sidebar-lists .tc-tab-set .tc-tab-divider {
	border-top: none;
	height: 1px;
	
background-image: linear-gradient(left, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 100%);
background-image: -o-linear-gradient(left, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 100%);
background-image: -moz-linear-gradient(left, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 100%);
background-image: -webkit-linear-gradient(left, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 100%);
background-image: -ms-linear-gradient(left, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.0) 100%);

}.tc-more-sidebar > .tc-tab-set > .tc-tab-buttons > button {
	
background-image: linear-gradient(left, rgba(0,0,0,0.01) 0%, rgba(0,0,0,0.1) 100%);
background-image: -o-linear-gradient(left, rgba(0,0,0,0.01) 0%, rgba(0,0,0,0.1) 100%);
background-image: -moz-linear-gradient(left, rgba(0,0,0,0.01) 0%, rgba(0,0,0,0.1) 100%);
background-image: -webkit-linear-gradient(left, rgba(0,0,0,0.01) 0%, rgba(0,0,0,0.1) 100%);
background-image: -ms-linear-gradient(left, rgba(0,0,0,0.01) 0%, rgba(0,0,0,0.1) 100%);

}.tc-more-sidebar > .tc-tab-set > .tc-tab-buttons > button.tc-tab-selected {
	
background-image: linear-gradient(left, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0.05) 100%);
background-image: -o-linear-gradient(left, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0.05) 100%);
background-image: -moz-linear-gradient(left, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0.05) 100%);
background-image: -webkit-linear-gradient(left, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0.05) 100%);
background-image: -ms-linear-gradient(left, rgba(0,0,0,0.05) 0%, rgba(255,255,255,0.05) 100%);

}.tc-message-box img {
	
  -webkit-box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
     -moz-box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
          box-shadow: 1px 1px 3px rgba(0,0,0,0.5);

}.tc-plugin-info {
	
  -webkit-box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
     -moz-box-shadow: 1px 1px 3px rgba(0,0,0,0.5);
          box-shadow: 1px 1px 3px rgba(0,0,0,0.5);

}


/*
** Start with the normalize CSS reset, and then belay some of its effects
*//*! normalize.css v3.0.0 | MIT License | git.io/normalize */

/**
 * 1. Set default font family to sans-serif.
 * 2. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}

/**
 * Remove default margin.
 */

body {
  margin: 0;
}

/* HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 8/9.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
  display: block;
}

/**
 * 1. Correct `inline-block` display not defined in IE 8/9.
 * 2. Normalize vertical alignment of `progress` in Chrome, Firefox, and Opera.
 */

audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
  display: none;
  height: 0;
}

/**
 * Address `[hidden]` styling not present in IE 8/9.
 * Hide the `template` element in IE, Safari, and Firefox < 22.
 */

[hidden],
template {
  display: none;
}

/* Links
   ========================================================================== */

/**
 * Remove the gray background color from active links in IE 10.
 */

a {
  background: transparent;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
  outline: 0;
}

/* Text-level semantics
   ========================================================================== */

/**
 * Address styling not present in IE 8/9, Safari 5, and Chrome.
 */

abbr[title] {
  border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome.
 */

b,
strong {
  font-weight: bold;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
  font-style: italic;
}

/**
 * Address variable `h1` font-size and margin within `section` and `article`
 * contexts in Firefox 4+, Safari 5, and Chrome.
 */

h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

/**
 * Address styling not present in IE 8/9.
 */

mark {
  background: #ff0;
  color: #000;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
  font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}

sup {
  top: -0.5em;
}

sub {
  bottom: -0.25em;
}

/* Embedded content
   ========================================================================== */

/**
 * Remove border when inside `a` element in IE 8/9.
 */

img {
  border: 0;
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
  overflow: hidden;
}

/* Grouping content
   ========================================================================== */

/**
 * Address margin not present in IE 8/9 and Safari 5.
 */

figure {
  margin: 1em 40px;
}

/**
 * Address differences between Firefox and other browsers.
 */

hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

/**
 * Contain overflow in all browsers.
 */

pre {
  overflow: auto;
}

/**
 * Address odd `em`-unit font size rendering in all browsers.
 */

code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

/* Forms
   ========================================================================== */

/**
 * Known limitation: by default, Chrome and Safari on OS X allow very limited
 * styling of `select`, unless a `border` property is set.
 */

/**
 * 1. Correct color not being inherited.
 *    Known issue: affects color of disabled elements.
 * 2. Correct font properties not being inherited.
 * 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome.
 */

button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}

/**
 * Address `overflow` set to `hidden` in IE 8/9/10.
 */

button {
  overflow: visible;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Firefox, IE 8+, and Opera
 * Correct `select` style inheritance in Firefox.
 */

button,
select {
  text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
  cursor: default;
}

/**
 * Remove inner padding and border in Firefox 4+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}

/**
 * Address Firefox 4+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

input {
  line-height: normal;
}

/**
 * It's recommended that you don't attempt to style these elements.
 * Firefox's implementation doesn't respect box-sizing, padding, or width.
 *
 * 1. Address box sizing set to `content-box` in IE 8/9/10.
 * 2. Remove excess padding in IE 8/9/10.
 */

input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Fix the cursor style for Chrome's increment/decrement buttons. For certain
 * `font-size` values of the `input`, it causes the cursor style of the
 * decrement button to change from `default` to `text`.
 */

input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari and Chrome on OS X.
 * Safari (but not Chrome) clips the cancel button when the search input has
 * padding (and `textfield` appearance).
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct `color` not being inherited in IE 8/9.
 * 2. Remove padding so people aren't caught out if they zero out fieldsets.
 */

legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}

/**
 * Remove default vertical scrollbar in IE 8/9.
 */

textarea {
  overflow: auto;
}

/**
 * Don't inherit the `font-weight` (applied by a rule above).
 * NOTE: the default cannot safely be changed in Chrome and Safari on OS X.
 */

optgroup {
  font-weight: bold;
}

/* Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
  border-collapse: collapse;
  border-spacing: 0;
}

td,
th {
  padding: 0;
}
*, input[type="search"] {
	box-sizing: border-box;
	-moz-box-sizing: border-box;
	-webkit-box-sizing: border-box;
}html button {
	line-height: 1.2;
	color: ;
	background: ;
	border-color: ;
}/*
** Basic element styles
*/html {
	font-family: "Helvetica Neue", Helvetica, Arial, "Lucida Grande", "DejaVu Sans", sans-serif;
	text-rendering: optimizeLegibility; /* Enables kerning and ligatures etc. */
	-webkit-font-smoothing: antialiased;
	-moz-osx-font-smoothing: grayscale;
}html:-webkit-full-screen {
	background-color: #f4f4f4;
}body.tc-body {
	font-size: 14px;
	line-height: 20px;
	word-wrap: break-word;
	


	color: #333333;
	background-color: #f4f4f4;
	fill: #333333;
}h1, h2, h3, h4, h5, h6 {
	line-height: 1.2;
	font-weight: 300;
}pre {
	display: block;
	padding: 14px;
	margin-top: 1em;
	margin-bottom: 1em;
	word-break: normal;
	word-wrap: break-word;
	white-space: pre-wrap;
	background-color: #f5f5f5;
	border: 1px solid #cccccc;
	padding: 0 3px 2px;
	border-radius: 3px;
	font-family: Monaco, Consolas, "Lucida Console", "DejaVu Sans Mono", monospace;
}code {
	color: #dd1144;
	background-color: #f7f7f9;
	border: 1px solid #e1e1e8;
	white-space: pre-wrap;
	padding: 0 3px 2px;
	border-radius: 3px;
	font-family: Monaco, Consolas, "Lucida Console", "DejaVu Sans Mono", monospace;
}blockquote {
	border-left: 5px solid #bbb;
	margin-left: 25px;
	padding-left: 10px;
	quotes: "\201C""\201D""\2018""\2019";
}blockquote.tc-big-quote {
	font-family: Georgia, serif;
	position: relative;
	background: #f5f5f5;
	border-left: none;
	margin-left: 50px;
	margin-right: 50px;
	padding: 10px;
    border-radius: 8px;
}blockquote.tc-big-quote cite:before {
	content: "\2014 \2009";
}blockquote.tc-big-quote:before {
	font-family: Georgia, serif;
	color: #bbb;
	content: open-quote;
	font-size: 8em;
	line-height: 0.1em;
	margin-right: 0.25em;
	vertical-align: -0.4em;
	position: absolute;
    left: -50px;
    top: 42px;
}blockquote.tc-big-quote:after {
	font-family: Georgia, serif;
	color: #bbb;
	content: close-quote;
	font-size: 8em;
	line-height: 0.1em;
	margin-right: 0.25em;
	vertical-align: -0.4em;
	position: absolute;
    right: -80px;
    bottom: -20px;
}dl dt {
	font-weight: bold;
	margin-top: 6px;
}textarea,
input[type=text],
input[type=search],
input[type=""],
input:not([type]) {
	color: #333333;
	background: #ffffff;
}.tc-muted {
	color: #bbb;
}svg.tc-image-button {
	padding: 0px 1px 1px 0px;
}.tc-icon-wrapper > svg {
	width: 1em;
	height: 1em;
}kbd {
	display: inline-block;
	padding: 3px 5px;
	font-size: 0.8em;
	line-height: 1.2;
	color: #333333;
	vertical-align: middle;
	background-color: #ffffff;
	border: solid 1px #bbb;
	border-bottom-color: #bbb;
	border-radius: 3px;
	box-shadow: inset 0 -1px 0 #bbb;
}/*
Markdown likes putting code elements inside pre elements
*/
pre > code {
	padding: 0;
	border: none;
	background-color: inherit;
	color: inherit;
}table {
	border: 1px solid #dddddd;
	width: auto;
	max-width: 100%;
	caption-side: bottom;
	margin-top: 1em;
	margin-bottom: 1em;
}table th, table td {
	padding: 0 7px 0 7px;
	border-top: 1px solid #dddddd;
	border-left: 1px solid #dddddd;
}table thead tr td, table th {
	background-color: #f0f0f0;
	font-weight: bold;
}table tfoot tr td {
	background-color: #a8a8a8;
}.tc-csv-table {
	white-space: nowrap;
}.tc-tiddler-frame img,
.tc-tiddler-frame svg,
.tc-tiddler-frame canvas,
.tc-tiddler-frame embed,
.tc-tiddler-frame iframe {
	max-width: 100%;
}.tc-tiddler-body > embed,
.tc-tiddler-body > iframe {
	width: 100%;
	height: 600px;
}/*
** Links
*/button.tc-tiddlylink,
a.tc-tiddlylink {
	text-decoration: none;
	font-weight: normal;
	color: #5778d8;
	-webkit-user-select: inherit; /* Otherwise the draggable attribute makes links impossible to select */
}.tc-sidebar-lists a.tc-tiddlylink {
	color: #999999;
}.tc-sidebar-lists a.tc-tiddlylink:hover {
	color: #444444;
}button.tc-tiddlylink:hover,
a.tc-tiddlylink:hover {
	text-decoration: underline;
}a.tc-tiddlylink-resolves {
}a.tc-tiddlylink-shadow {
	font-weight: bold;
}a.tc-tiddlylink-shadow.tc-tiddlylink-resolves {
	font-weight: normal;
}a.tc-tiddlylink-missing {
	font-style: italic;
}a.tc-tiddlylink-external {
	text-decoration: underline;
	color: #0000ee;
	background-color: inherit;
}a.tc-tiddlylink-external:visited {
	color: #0000aa;
	background-color: inherit;
}a.tc-tiddlylink-external:hover {
	color: inherit;
	background-color: inherit;
}/*
** Drag and drop styles
*/.tc-tiddler-dragger {
	position: relative;
	z-index: -10000;
}.tc-tiddler-dragger-inner {
	position: absolute;
	top: -1000px;
	left: -1000px;
	display: inline-block;
	padding: 8px 20px;
	font-size: 16.9px;
	font-weight: bold;
	line-height: 20px;
	color: #ffffff;
	text-shadow: 0 1px 0 rgba(0, 0, 0, 1);
	white-space: nowrap;
	vertical-align: baseline;
	background-color: #333333;
	border-radius: 20px;
}.tc-tiddler-dragger-cover {
	position: absolute;
	background-color: #f4f4f4;
}.tc-dropzone {
	position: relative;
}.tc-dropzone.tc-dragover:before {
	z-index: 10000;
	display: block;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	background: rgba(0,200,0,0.7);
	text-align: center;
	content: "Drop here (or use the 'Escape' key to cancel)";
}.tc-droppable > .tc-droppable-placeholder {
	display: none;
}.tc-droppable.tc-dragover > .tc-droppable-placeholder {
	display: block;
	border: 2px dashed rgba(0,200,0,0.7);
}.tc-draggable {
	cursor: move;
}/*
** Plugin reload warning
*/.tc-plugin-reload-warning {
	z-index: 1000;
	display: block;
	position: fixed;
	top: 0;
	left: 0;
	right: 0;
	background: #ffe476;
	text-align: center;
}/*
** Buttons
*/button svg, button img, label svg, label img {
	vertical-align: middle;
}.tc-btn-invisible {
	padding: 0;
	margin: 0;
	background: none;
	border: none;
    cursor: pointer;
}.tc-btn-boxed {
	font-size: 0.6em;
	padding: 0.2em;
	margin: 1px;
	background: none;
	border: 1px solid #cccccc;
	border-radius: 0.25em;
}html body.tc-body .tc-btn-boxed svg {
	font-size: 1.6666em;
}.tc-btn-boxed:hover {
	background: #bbb;
	color: #ffffff;
}html body.tc-body .tc-btn-boxed:hover svg {
	fill: #ffffff;
}.tc-btn-rounded {
	font-size: 0.5em;
	line-height: 2;
	padding: 0em 0.3em 0.2em 0.4em;
	margin: 1px;
	border: 1px solid #bbb;
	background: #bbb;
	color: #ffffff;
	border-radius: 2em;
}html body.tc-body .tc-btn-rounded svg {
	font-size: 1.6666em;
	fill: #ffffff;
}.tc-btn-rounded:hover {
	border: 1px solid #bbb;
	background: #ffffff;
	color: #bbb;
}html body.tc-body .tc-btn-rounded:hover svg {
	fill: #bbb;
}.tc-btn-icon svg {
	height: 1em;
	width: 1em;
	fill: #bbb;
}.tc-btn-text {
	padding: 0;
	margin: 0;
}.tc-btn-big-green {
	display: inline-block;
	padding: 8px;
	margin: 4px 8px 4px 8px;
	background: #34c734;
	color: #ffffff;
	fill: #ffffff;
	border: none;
	font-size: 1.2em;
	line-height: 1.4em;
	text-decoration: none;
}.tc-btn-big-green svg,
.tc-btn-big-green img {
	height: 2em;
	width: 2em;
	vertical-align: middle;
	fill: #ffffff;
}.tc-sidebar-lists input {
	color: #333333;
}.tc-sidebar-lists button {
	color: #333333;
	fill: #333333;
}.tc-sidebar-lists button.tc-btn-mini {
	color: #c0c0c0;
}.tc-sidebar-lists button.tc-btn-mini:hover {
	color: #444444;
}button svg.tc-image-button, button .tc-image-button img {
	height: 1em;
	width: 1em;
}.tc-unfold-banner {
	position: absolute;
	padding: 0;
	margin: 0;
	background: none;
	border: none;
	width: 100%;
	width: calc(100% + 2px);
	margin-left: -43px;
	text-align: center;
	border-top: 2px solid #f8f8f8;
	margin-top: 4px;
}.tc-unfold-banner:hover {
	background: #f8f8f8;
	border-top: 2px solid #dddddd;
}.tc-unfold-banner svg, .tc-fold-banner svg {
	height: 0.75em;
	fill: #cccccc;
}.tc-unfold-banner:hover svg, .tc-fold-banner:hover svg {
	fill: #888888;
}.tc-fold-banner {
	position: absolute;
	padding: 0;
	margin: 0;
	background: none;
	border: none;
	width: 23px;
	text-align: center;
	margin-left: -35px;
	top: 6px;
	bottom: 6px;
}.tc-fold-banner:hover {
	background: #f8f8f8;
}@media (max-width: 960px) {.tc-unfold-banner {
		position: static;
		width: calc(100% + 59px);
	}.tc-fold-banner {
		width: 16px;
		margin-left: -16px;
		font-size: 0.75em;
	}}/*
** Tags and missing tiddlers
*/.tc-tag-list-item {
	position: relative;
	display: inline-block;
	margin-right: 7px;
}.tc-tags-wrapper {
	margin: 4px 0 14px 0;
}.tc-missing-tiddler-label {
	font-style: italic;
	font-weight: normal;
	display: inline-block;
	font-size: 11.844px;
	line-height: 14px;
	white-space: nowrap;
	vertical-align: baseline;
}button.tc-tag-label, span.tc-tag-label {
	display: inline-block;
	padding: 0.16em 0.7em;
	font-size: 0.9em;
	font-weight: 400;
	line-height: 1.2em;
	color: #ffffff;
	white-space: nowrap;
	vertical-align: baseline;
	background-color: #ec6;
	border-radius: 1em;
}.tc-untagged-separator {
	width: 10em;
	left: 0;
	margin-left: 0;
	border: 0;
	height: 1px;
	background: #d8d8d8;
}button.tc-untagged-label {
	background-color: #999999;
}.tc-tag-label svg, .tc-tag-label img {
	height: 1em;
	width: 1em;
	fill: #ffffff;
	vertical-align: text-bottom;
}.tc-tag-manager-table .tc-tag-label {
	white-space: normal;
}.tc-tag-manager-tag {
	width: 100%;
}/*
** Page layout
*/.tc-topbar {
	position: fixed;
	z-index: 1200;
}.tc-topbar-left {
	left: 29px;
	top: 5px;
}.tc-topbar-right {
	top: 5px;
	right: 29px;
}.tc-topbar button {
	padding: 8px;
}.tc-topbar svg {
	fill: #bbb;
}.tc-topbar button:hover svg {
	fill: #333333;
}.tc-sidebar-header {
	color: #acacac;
	fill: #acacac;
}.tc-sidebar-header .tc-title a.tc-tiddlylink-resolves {
	font-weight: 300;
}.tc-sidebar-header .tc-sidebar-lists p {
	margin-top: 3px;
	margin-bottom: 3px;
}.tc-sidebar-header .tc-missing-tiddler-label {
	color: #acacac;
}.tc-advanced-search input {
	width: 60%;
}.tc-search a svg {
	width: 1.2em;
	height: 1.2em;
	vertical-align: middle;
}.tc-page-controls {
	margin-top: 14px;
	font-size: 1.5em;
}.tc-page-controls button {
	margin-right: 0.5em;
}.tc-page-controls a.tc-tiddlylink:hover {
	text-decoration: none;
}.tc-page-controls img {
	width: 1em;
}.tc-page-controls svg {
	fill: #aaaaaa;
}.tc-page-controls button:hover svg, .tc-page-controls a:hover svg {
	fill: #000000;
}.tc-menu-list-item {
	white-space: nowrap;
}.tc-menu-list-count {
	font-weight: bold;
}.tc-menu-list-subitem {
	padding-left: 7px;
}.tc-story-river {
	position: relative;
}@media (max-width: 960px) {.tc-sidebar-header {
		padding: 14px;
		min-height: 32px;
		margin-top: 0px;
	}.tc-story-river {
		position: relative;
		padding: 0;
	}
}@media (min-width: 960px) {.tc-message-box {
		margin: 21px -21px 21px -21px;
	}.tc-sidebar-scrollable {
		position: fixed;
		top: 0px;
		left: 770px;
		bottom: 0;
		right: 0;
		overflow-y: auto;
		overflow-x: auto;
		-webkit-overflow-scrolling: touch;
		margin: 0 0 0 -42px;
		padding: 71px 0 28px 42px;
	}html[dir="rtl"] .tc-sidebar-scrollable {
		left: auto;
		right: 770px;
	}.tc-story-river {
		position: relative;
		left: 0px;
		top: 0px;
		width: 770px;
		padding: 42px 42px 42px 42px;
	}}@media print {body.tc-body {
		background-color: transparent;
	}.tc-sidebar-header, .tc-topbar {
		display: none;
	}.tc-story-river {
		margin: 0;
		padding: 0;
	}.tc-story-river .tc-tiddler-frame {
		margin: 0;
		border: none;
		padding: 0;
	}
}/*
** Tiddler styles
*/.tc-tiddler-frame {
	position: relative;
	margin-bottom: 28px;
	background-color: #ffffff;
	border: 1px solid #ffffff;
}
.tc-tiddler-info {
	padding: 14px 42px 14px 42px;
	background-color: #f8f8f8;
	border-top: 1px solid #dddddd;
	border-bottom: 1px solid #dddddd;
}.tc-tiddler-info p {
	margin-top: 3px;
	margin-bottom: 3px;
}.tc-tiddler-info .tc-tab-buttons button.tc-tab-selected {
	background-color: #f8f8f8;
	border-bottom: 1px solid #f8f8f8;
}.tc-view-field-table {
	width: 100%;
}.tc-view-field-name {
	width: 1%; /* Makes this column be as narrow as possible */
	text-align: right;
	font-style: italic;
	font-weight: 200;
}.tc-view-field-value {
}@media (max-width: 960px) {
	.tc-tiddler-frame {
		padding: 14px 14px 14px 14px;
	}.tc-tiddler-info {
		margin: 0 -14px 0 -14px;
	}
}@media (min-width: 960px) {
	.tc-tiddler-frame {
		padding: 28px 42px 42px 42px;
		width: 686px;
		border-radius: 2px;
	}.tc-tiddler-info {
		margin: 0 -42px 0 -42px;
	}
}.tc-site-title,
.tc-titlebar {
	font-weight: 300;
	font-size: 2.35em;
	line-height: 1.2em;
	color: #182955;
	margin: 0;
}.tc-site-title {
	color: #182955;
}.tc-tiddler-title-icon {
	vertical-align: middle;
}.tc-system-title-prefix {
	color: #bbb;
}.tc-titlebar h2 {
	font-size: 1em;
	display: inline;
}.tc-titlebar img {
	height: 1em;
}.tc-subtitle {
	font-size: 0.9em;
	color: #c0c0c0;
	font-weight: 300;
}.tc-tiddler-missing .tc-title {
  font-style: italic;
  font-weight: normal;
}.tc-tiddler-frame .tc-tiddler-controls {
	float: right;
}.tc-tiddler-controls .tc-drop-down {
	font-size: 0.6em;
}.tc-tiddler-controls .tc-drop-down .tc-drop-down {
	font-size: 1em;
}.tc-tiddler-controls > span > button {
	vertical-align: baseline;
	margin-left:5px;
}.tc-tiddler-controls button svg, .tc-tiddler-controls button img,
.tc-search button svg, .tc-search a svg {
	fill: #cccccc;
}.tc-tiddler-controls button svg, .tc-tiddler-controls button img {
	height: 0.75em;
}.tc-search button svg, .tc-search a svg {
    height: 1.2em;
    width: 1.2em;
    margin: 0 0.25em;
}.tc-tiddler-controls button.tc-selected svg,
.tc-page-controls button.tc-selected svg  {
	fill: #444444;
}.tc-tiddler-controls button.tc-btn-invisible:hover svg,
.tc-search button:hover svg, .tc-search a:hover svg {
	fill: #888888;
}@media print {
	.tc-tiddler-controls {
		display: none;
	}
}.tc-tiddler-help { /* Help prompts within tiddler template */
	color: #bbb;
	margin-top: 14px;
}.tc-tiddler-help a.tc-tiddlylink {
	color: #888888;
}.tc-tiddler-frame .tc-edit-texteditor {
	width: 100%;
	margin: 4px 0 4px 0;
}.tc-tiddler-frame input.tc-edit-texteditor,
.tc-tiddler-frame textarea.tc-edit-texteditor,
.tc-tiddler-frame iframe.tc-edit-texteditor {
	padding: 3px 3px 3px 3px;
	border: 1px solid #cccccc;
	background-color: #f8f8f8;
	line-height: 1.3em;
	-webkit-appearance: none;
}.tc-tiddler-frame .tc-binary-warning {
	width: 100%;
	height: 5em;
	text-align: center;
	padding: 3em 3em 6em 3em;
	background: #ffe476;
	border: 1px solid #b99e2f;
}canvas.tc-edit-bitmapeditor  {
	border: 6px solid #ffffff;
	cursor: crosshair;
	-moz-user-select: none;
	-webkit-user-select: none;
	-ms-user-select: none;
	margin-top: 6px;
	margin-bottom: 6px;
}.tc-edit-bitmapeditor-width {
	display: block;
}.tc-edit-bitmapeditor-height {
	display: block;
}.tc-tiddler-body {
	clear: both;
}.tc-tiddler-frame .tc-tiddler-body {
	font-size: 15px;
	line-height: 22px;
}.tc-titlebar, .tc-tiddler-edit-title {
	overflow: hidden; /* https://github.com/Jermolene/TiddlyWiki5/issues/282 */
}html body.tc-body.tc-single-tiddler-window {
	margin: 1em;
	background: #ffffff;
}.tc-single-tiddler-window img,
.tc-single-tiddler-window svg,
.tc-single-tiddler-window canvas,
.tc-single-tiddler-window embed,
.tc-single-tiddler-window iframe {
	max-width: 100%;
}/*
** Editor
*/.tc-editor-toolbar {
	margin-top: 8px;
}.tc-editor-toolbar button {
	vertical-align: middle;
	background-color: #cccccc;
	fill: #444444;
	border-radius: 4px;
	padding: 3px;
	margin: 2px 0 2px 4px;
}.tc-editor-toolbar button.tc-text-editor-toolbar-item-adjunct {
	margin-left: 1px;
	width: 1em;
	border-radius: 8px;
}.tc-editor-toolbar button.tc-text-editor-toolbar-item-start-group {
	margin-left: 11px;
}.tc-editor-toolbar button.tc-selected {
	background-color: #5778d8;
}.tc-editor-toolbar button svg {
	width: 1.6em;
	height: 1.2em;
}.tc-editor-toolbar button:hover {
	background-color: #444444;
	fill: #ffffff;
}.tc-editor-toolbar .tc-text-editor-toolbar-more {
	white-space: normal;
}.tc-editor-toolbar .tc-text-editor-toolbar-more button {
	display: inline-block;
	padding: 3px;
	width: auto;
}.tc-editor-toolbar .tc-search-results {
	padding: 0;
}/*
** Adjustments for fluid-fixed mode
*/@media (min-width: 960px) {}/*
** Toolbar buttons
*/.tc-page-controls svg.tc-image-new-button {
  fill: ;
}.tc-page-controls svg.tc-image-options-button {
  fill: ;
}.tc-page-controls svg.tc-image-save-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-info-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-edit-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-close-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-delete-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-cancel-button {
  fill: ;
}.tc-tiddler-controls button svg.tc-image-done-button {
  fill: ;
}/*
** Tiddler edit mode
*/.tc-tiddler-edit-frame em.tc-edit {
	color: #bbb;
	font-style: normal;
}.tc-edit-type-dropdown a.tc-tiddlylink-missing {
	font-style: normal;
}.tc-edit-tags {
	border: 1px solid #cccccc;
	padding: 4px 8px 4px 8px;
}.tc-edit-add-tag {
	display: inline-block;
}.tc-edit-add-tag .tc-add-tag-name input {
	width: 50%;
}.tc-edit-add-tag .tc-keyboard {
	display:inline;
}.tc-edit-tags .tc-tag-label {
	display: inline-block;
}.tc-edit-tags-list {
	margin: 14px 0 14px 0;
}.tc-remove-tag-button {
	padding-left: 4px;
}.tc-tiddler-preview {
	overflow: auto;
}.tc-tiddler-preview-preview {
	float: right;
	width: 49%;
	border: 1px solid #cccccc;
	margin: 4px 0 3px 3px;
	padding: 3px 3px 3px 3px;
}.tc-tiddler-frame .tc-tiddler-preview .tc-edit-texteditor {
	width: 49%;
}.tc-tiddler-frame .tc-tiddler-preview canvas.tc-edit-bitmapeditor {
	max-width: 49%;
}.tc-edit-fields {
	width: 100%;
}.tc-edit-fields table, .tc-edit-fields tr, .tc-edit-fields td {
	border: none;
	padding: 4px;
}.tc-edit-fields > tbody > .tc-edit-field:nth-child(odd) {
	background-color: #f0f4f0;
}.tc-edit-fields > tbody > .tc-edit-field:nth-child(even) {
	background-color: #e0e8e0;
}.tc-edit-field-name {
	text-align: right;
}.tc-edit-field-value input {
	width: 100%;
}.tc-edit-field-remove {
}.tc-edit-field-remove svg {
	height: 1em;
	width: 1em;
	fill: #bbb;
	vertical-align: middle;
}.tc-edit-field-add-name {
	display: inline-block;
	width: 15%;
}.tc-edit-field-add-value {
	display: inline-block;
	width: 40%;
}.tc-edit-field-add-button {
	display: inline-block;
	width: 10%;
}/*
** Storyview Classes
*/.tc-storyview-zoomin-tiddler {
	position: absolute;
	display: block;
	width: 100%;
}@media (min-width: 960px) {.tc-storyview-zoomin-tiddler {
		width: calc(100% - 84px);
	}}/*
** Dropdowns
*/.tc-btn-dropdown {
	text-align: left;
}.tc-btn-dropdown svg, .tc-btn-dropdown img {
	height: 1em;
	width: 1em;
	fill: #bbb;
}.tc-drop-down-wrapper {
	position: relative;
}.tc-drop-down {
	min-width: 380px;
	border: 1px solid #bbb;
	background-color: #ffffff;
	padding: 7px 0 7px 0;
	margin: 4px 0 0 0;
	white-space: nowrap;
	text-shadow: none;
	line-height: 1.4;
}.tc-drop-down .tc-drop-down {
	margin-left: 14px;
}.tc-drop-down button svg, .tc-drop-down a svg  {
	fill: #333333;
}.tc-drop-down button.tc-btn-invisible:hover svg {
	fill: #333333;
}.tc-drop-down p {
	padding: 0 14px 0 14px;
}.tc-drop-down svg {
	width: 1em;
	height: 1em;
}.tc-drop-down img {
	width: 1em;
}.tc-drop-down-language-chooser img {
	width: 2em;
	vertical-align: baseline;
}.tc-drop-down a, .tc-drop-down button {
	display: block;
	padding: 0 14px 0 14px;
	width: 100%;
	text-align: left;
	color: #333333;
	line-height: 1.4;
}.tc-drop-down .tc-tab-set .tc-tab-buttons button {
	display: inline-block;
    width: auto;
    margin-bottom: 0px;
    border-bottom-left-radius: 0;
    border-bottom-right-radius: 0;
}.tc-drop-down .tc-prompt {
	padding: 0 14px;
}.tc-drop-down .tc-chooser {
	border: none;
}.tc-drop-down .tc-chooser .tc-swatches-horiz {
	font-size: 0.4em;
	padding-left: 1.2em;
}.tc-drop-down .tc-file-input-wrapper {
	width: 100%;
}.tc-drop-down .tc-file-input-wrapper button {
	color: #333333;
}.tc-drop-down a:hover, .tc-drop-down button:hover, .tc-drop-down .tc-file-input-wrapper:hover button {
	color: #ffffff;
	background-color: #5778d8;
	text-decoration: none;
}.tc-drop-down .tc-tab-buttons button {
	background-color: #ececec;
}.tc-drop-down .tc-tab-buttons button.tc-tab-selected {
	background-color: #fff;
	border-bottom: 1px solid #fff;
}.tc-drop-down-bullet {
	display: inline-block;
	width: 0.5em;
}.tc-drop-down .tc-tab-contents a {
	padding: 0 0.5em 0 0.5em;
}.tc-block-dropdown-wrapper {
	position: relative;
}.tc-block-dropdown {
	position: absolute;
	min-width: 220px;
	border: 1px solid #bbb;
	background-color: #ffffff;
	padding: 7px 0;
	margin: 4px 0 0 0;
	white-space: nowrap;
	z-index: 1000;
	text-shadow: none;
}.tc-block-dropdown.tc-search-drop-down {
	margin-left: -12px;
}.tc-block-dropdown a {
	display: block;
	padding: 4px 14px 4px 14px;
}.tc-block-dropdown.tc-search-drop-down a {
	display: block;
	padding: 0px 10px 0px 10px;
}.tc-drop-down .tc-dropdown-item-plain,
.tc-block-dropdown .tc-dropdown-item-plain {
	padding: 4px 14px 4px 7px;
}.tc-drop-down .tc-dropdown-item,
.tc-block-dropdown .tc-dropdown-item {
	padding: 4px 14px 4px 7px;
	color: #bbb;
}.tc-block-dropdown a:hover {
	color: #ffffff;
	background-color: #5778d8;
	text-decoration: none;
}.tc-search-results {
	padding: 0 7px 0 7px;
}.tc-image-chooser, .tc-colour-chooser {
	white-space: normal;
}.tc-image-chooser a,
.tc-colour-chooser a {
	display: inline-block;
	vertical-align: top;
	text-align: center;
	position: relative;
}.tc-image-chooser a {
	border: 1px solid #bbb;
	padding: 2px;
	margin: 2px;
	width: 4em;
	height: 4em;
}.tc-colour-chooser a {
	padding: 3px;
	width: 2em;
	height: 2em;
	vertical-align: middle;
}.tc-image-chooser a:hover,
.tc-colour-chooser a:hover {
	background: #5778d8;
	padding: 0px;
	border: 3px solid #5778d8;
}.tc-image-chooser a svg,
.tc-image-chooser a img {
	display: inline-block;
	width: auto;
	height: auto;
	max-width: 3.5em;
	max-height: 3.5em;
	position: absolute;
	top: 0;
	bottom: 0;
	left: 0;
	right: 0;
	margin: auto;
}/*
** Modals
*/.tc-modal-wrapper {
	position: fixed;
	overflow: auto;
	overflow-y: scroll;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	z-index: 900;
}.tc-modal-backdrop {
	position: fixed;
	top: 0;
	right: 0;
	bottom: 0;
	left: 0;
	z-index: 1000;
	background-color: #333333;
}.tc-modal {
	z-index: 1100;
	background-color: #ffffff;
	border: 1px solid #999999;
}@media (max-width: 55em) {
	.tc-modal {
		position: fixed;
		top: 1em;
		left: 1em;
		right: 1em;
	}.tc-modal-body {
		overflow-y: auto;
		max-height: 400px;
		max-height: 60vh;
	}
}@media (min-width: 55em) {
	.tc-modal {
		position: fixed;
		top: 2em;
		left: 25%;
		width: 50%;
	}.tc-modal-body {
		overflow-y: auto;
		max-height: 400px;
		max-height: 60vh;
	}
}.tc-modal-header {
	padding: 9px 15px;
	border-bottom: 1px solid #eeeeee;
}.tc-modal-header h3 {
	margin: 0;
	line-height: 30px;
}.tc-modal-header img, .tc-modal-header svg {
	width: 1em;
	height: 1em;
}.tc-modal-body {
	padding: 15px;
}.tc-modal-footer {
	padding: 14px 15px 15px;
	margin-bottom: 0;
	text-align: right;
	background-color: #f5f5f5;
	border-top: 1px solid #dddddd;
}/*
** Notifications
*/.tc-notification {
	position: fixed;
	top: 14px;
	right: 42px;
	z-index: 1300;
	max-width: 280px;
	padding: 0 14px 0 14px;
	background-color: #ffffdd;
	border: 1px solid #999999;
}/*
** Tabs
*/.tc-tab-set.tc-vertical {
	display: -webkit-flex;
	display: flex;
}.tc-tab-buttons {
	font-size: 0.85em;
	padding-top: 1em;
	margin-bottom: -2px;
}.tc-tab-buttons.tc-vertical  {
	z-index: 100;
	display: block;
	padding-top: 14px;
	vertical-align: top;
	text-align: right;
	margin-bottom: inherit;
	margin-right: -1px;
	max-width: 33%;
	-webkit-flex: 0 0 auto;
	flex: 0 0 auto;
}.tc-tab-buttons button.tc-tab-selected {
	color: #666666;
	background-color: #ffffff;
	border-left: 1px solid #d8d8d8;
	border-top: 1px solid #d8d8d8;
	border-right: 1px solid #d8d8d8;
}.tc-tab-buttons button {
	color: #666666;
	padding: 3px 5px 3px 5px;
	margin-right: 0.3em;
	font-weight: 300;
	border: none;
	background: inherit;
	background-color: #d8d8d8;
	border-left: 1px solid #cccccc;
	border-top: 1px solid #cccccc;
	border-right: 1px solid #cccccc;
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
}.tc-tab-buttons.tc-vertical button {
	display: block;
	width: 100%;
	margin-top: 3px;
	margin-right: 0;
	text-align: right;
	background-color: #d8d8d8;
	border-left: 1px solid #cccccc;
	border-bottom: 1px solid #cccccc;
	border-right: none;
	border-top-left-radius: 2px;
	border-bottom-left-radius: 2px;
}.tc-tab-buttons.tc-vertical button.tc-tab-selected {
	background-color: #ffffff;
	border-right: 1px solid #ffffff;
}.tc-tab-divider {
	border-top: 1px solid #d8d8d8;
}.tc-tab-divider.tc-vertical  {
	display: none;
}.tc-tab-content {
	margin-top: 14px;
}.tc-tab-content.tc-vertical  {
	display: inline-block;
	vertical-align: top;
	padding-top: 0;
	padding-left: 14px;
	border-left: 1px solid #cccccc;
	-webkit-flex: 1 0 70%;
	flex: 1 0 70%;
}.tc-sidebar-lists .tc-tab-buttons {
	margin-bottom: -1px;
}.tc-sidebar-lists .tc-tab-buttons button.tc-tab-selected {
	background-color: #f4f4f4;
	color: ;
	border-left: 1px solid #d8d8d8;
	border-top: 1px solid #d8d8d8;
	border-right: 1px solid #d8d8d8;
}.tc-sidebar-lists .tc-tab-buttons button {
	background-color: #e0e0e0;
	color: #666666;
	border-left: 1px solid #cccccc;
	border-top: 1px solid #cccccc;
	border-right: 1px solid #cccccc;
}.tc-sidebar-lists .tc-tab-divider {
	border-top: 1px solid #e4e4e4;
}.tc-more-sidebar > .tc-tab-set > .tc-tab-buttons > button {
	display: block;
	width: 100%;
	background-color: #e0e0e0;
	border-top: none;
	border-left: none;
	border-bottom: none;
	border-right: 1px solid #ccc;
	margin-bottom: inherit;
}.tc-more-sidebar > .tc-tab-set > .tc-tab-buttons > button.tc-tab-selected {
	background-color: #f4f4f4;
	border: none;
}/*
** Manager
*/.tc-manager-wrapper {
	
}.tc-manager-controls {
	
}.tc-manager-control {
	margin: 0.5em 0;
}.tc-manager-list {
	width: 100%;
	border-top: 1px solid #bbb;
	border-left: 1px solid #bbb;
	border-right: 1px solid #bbb;
}.tc-manager-list-item {}.tc-manager-list-item-heading {
    display: block;
    width: 100%;
    text-align: left;	
	border-bottom: 1px solid #bbb;
	padding: 3px;
}.tc-manager-list-item-heading-selected {
	font-weight: bold;
	color: #ffffff;
	fill: #ffffff;
	background-color: #333333;
}.tc-manager-list-item-heading:hover {
	background: #5778d8;
	color: #ffffff;
}.tc-manager-list-item-content {
	display: flex;
}.tc-manager-list-item-content-sidebar {
    flex: 1 0;
    background: #f8f8f8;
    border-right: 0.5em solid #bbb;
    border-bottom: 0.5em solid #bbb;
    white-space: nowrap;
}.tc-manager-list-item-content-item-heading {
	display: block;
	width: 100%;
	text-align: left;
    background: #bbb;
	text-transform: uppercase;
	font-size: 0.6em;
	font-weight: bold;
    padding: 0.5em 0 0.5em 0;
}.tc-manager-list-item-content-item-body {
	padding: 0 0.5em 0 0.5em;
}.tc-manager-list-item-content-item-body > pre {
	margin: 0.5em 0 0.5em 0;
	border: none;
	background: inherit;
}.tc-manager-list-item-content-tiddler {
    flex: 3 1;
    border-left: 0.5em solid #bbb;
    border-right: 0.5em solid #bbb;
    border-bottom: 0.5em solid #bbb;
}.tc-manager-list-item-content-item-body > table {
	border: none;
	padding: 0;
	margin: 0;
}.tc-manager-list-item-content-item-body > table td {
	border: none;
}.tc-manager-icon-editor > button {
	width: 100%;
}.tc-manager-icon-editor > button > svg,
.tc-manager-icon-editor > button > button {
	width: 100%;
	height: auto;
}/*
** Alerts
*/.tc-alerts {
	position: fixed;
	top: 0;
	left: 0;
	max-width: 500px;
	z-index: 20000;
}.tc-alert {
	position: relative;
	margin: 28px;
	padding: 14px 14px 14px 14px;
	border: 2px solid #b99e2f;
	background-color: #ffe476;
}.tc-alert-toolbar {
	position: absolute;
	top: 14px;
	right: 14px;
}.tc-alert-toolbar svg {
	fill: #b99e2f;
}.tc-alert-subtitle {
	color: #b99e2f;
	font-weight: bold;
}.tc-alert-highlight {
	color: #881122;
}@media (min-width: 960px) {.tc-static-alert {
		position: relative;
	}.tc-static-alert-inner {
		position: absolute;
		z-index: 100;
	}}.tc-static-alert-inner {
	padding: 0 2px 2px 42px;
	color: #aaaaaa;
}/*
** Control panel
*/.tc-control-panel td {
	padding: 4px;
}.tc-control-panel table, .tc-control-panel table input, .tc-control-panel table textarea {
	width: 100%;
}.tc-plugin-info {
	display: block;
	border: 1px solid #bbb;
	background-colour: #ffffff;
	margin: 0.5em 0 0.5em 0;
	padding: 4px;
}.tc-plugin-info-disabled {
	background: -webkit-repeating-linear-gradient(45deg, #ff0, #ff0 10px, #eee 10px, #eee 20px);
	background: repeating-linear-gradient(45deg, #ff0, #ff0 10px, #eee 10px, #eee 20px);
}.tc-plugin-info-disabled:hover {
	background: -webkit-repeating-linear-gradient(45deg, #aa0, #aa0 10px, #888 10px, #888 20px);
	background: repeating-linear-gradient(45deg, #aa0, #aa0 10px, #888 10px, #888 20px);
}a.tc-tiddlylink.tc-plugin-info:hover {
	text-decoration: none;
	background-color: #5778d8;
	color: #ffffff;
	fill: #333333;
}a.tc-tiddlylink.tc-plugin-info:hover .tc-plugin-info > .tc-plugin-info-chunk > svg {
	fill: #333333;
}.tc-plugin-info-chunk {
	display: inline-block;
	vertical-align: middle;
}.tc-plugin-info-chunk h1 {
	font-size: 1em;
	margin: 2px 0 2px 0;
}.tc-plugin-info-chunk h2 {
	font-size: 0.8em;
	margin: 2px 0 2px 0;
}.tc-plugin-info-chunk div {
	font-size: 0.7em;
	margin: 2px 0 2px 0;
}.tc-plugin-info:hover > .tc-plugin-info-chunk > img, .tc-plugin-info:hover > .tc-plugin-info-chunk > svg {
	width: 2em;
	height: 2em;
	fill: #333333;
}.tc-plugin-info > .tc-plugin-info-chunk > img, .tc-plugin-info > .tc-plugin-info-chunk > svg {
	width: 2em;
	height: 2em;
	fill: #bbb;
}.tc-plugin-info.tc-small-icon > .tc-plugin-info-chunk > img, .tc-plugin-info.tc-small-icon > .tc-plugin-info-chunk > svg {
	width: 1em;
	height: 1em;
}.tc-plugin-info-dropdown {
	border: 1px solid #bbb;
	margin-top: -8px;
}.tc-plugin-info-dropdown-message {
	background: #ecf2ff;
	padding: 0.5em 1em 0.5em 1em;
	font-weight: bold;
	font-size: 0.8em;
}.tc-plugin-info-dropdown-body {
	padding: 1em 1em 1em 1em;
}/*
** Message boxes
*/.tc-message-box {
	border: 1px solid #cfd6e6;
	background: #ecf2ff;
	padding: 0px 21px 0px 21px;
	font-size: 12px;
	line-height: 18px;
	color: #547599;
}.tc-message-box svg {
	width: 1em;
	height: 1em;
    vertical-align: text-bottom;
}/*
** Pictures
*/.tc-bordered-image {
	border: 1px solid #bbb;
	padding: 5px;
	margin: 5px;
}/*
** Floats
*/.tc-float-right {
	float: right;
}/*
** Chooser
*/.tc-chooser {
	border: 1px solid #dddddd;
}.tc-chooser-item {
	border: 8px;
	padding: 2px 4px;
}.tc-chooser-item a.tc-tiddlylink {
	display: block;
	text-decoration: none;
	color: #5778d8;
	background-color: #ffffff;
}.tc-chooser-item a.tc-tiddlylink:hover {
	text-decoration: none;
	color: #ffffff;
	background-color: #5778d8;
}/*
** Palette swatches
*/.tc-swatches-horiz {
}.tc-swatches-horiz .tc-swatch {
	display: inline-block;
}.tc-swatch {
	width: 2em;
	height: 2em;
	margin: 0.4em;
	border: 1px solid #888;
}/*
** Table of contents
*/.tc-sidebar-lists .tc-table-of-contents {
	white-space: nowrap;
}.tc-table-of-contents button {
	color: #acacac;
}.tc-table-of-contents svg {
	width: 0.7em;
	height: 0.7em;
	vertical-align: middle;
	fill: #acacac;
}.tc-table-of-contents ol {
	list-style-type: none;
	padding-left: 0;
}.tc-table-of-contents ol ol {
	padding-left: 1em;
}.tc-table-of-contents li {
	font-size: 1.0em;
	font-weight: bold;
}.tc-table-of-contents li a {
	font-weight: bold;
}.tc-table-of-contents li li {
	font-size: 0.95em;
	font-weight: normal;
	line-height: 1.4;
}.tc-table-of-contents li li a {
	font-weight: normal;
}.tc-table-of-contents li li li {
	font-size: 0.95em;
	font-weight: 200;
	line-height: 1.5;
}.tc-table-of-contents li li li a {
	font-weight: bold;
}.tc-table-of-contents li li li li {
	font-size: 0.95em;
	font-weight: 200;
}.tc-tabbed-table-of-contents {
	display: -webkit-flex;
	display: flex;
}.tc-tabbed-table-of-contents .tc-table-of-contents {
	z-index: 100;
	display: inline-block;
	padding-left: 1em;
	max-width: 50%;
	-webkit-flex: 0 0 auto;
	flex: 0 0 auto;
	background: #d8d8d8;
	border-left: 1px solid #cccccc;
	border-top: 1px solid #cccccc;
	border-bottom: 1px solid #cccccc;
}.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item > a,
.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item-selected > a {
	display: block;
	padding: 0.12em 1em 0.12em 0.25em;
}.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item > a {
	border-top: 1px solid #d8d8d8;
	border-left: 1px solid #d8d8d8;
	border-bottom: 1px solid #d8d8d8;
}.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item > a:hover {
	text-decoration: none;
	border-top: 1px solid #cccccc;
	border-left: 1px solid #cccccc;
	border-bottom: 1px solid #cccccc;
	background: #cccccc;
}.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item-selected > a {
	border-top: 1px solid #cccccc;
	border-left: 1px solid #cccccc;
	border-bottom: 1px solid #cccccc;
	background: #ffffff;
	margin-right: -1px;
}.tc-tabbed-table-of-contents .tc-table-of-contents .toc-item-selected > a:hover {
	text-decoration: none;
}.tc-tabbed-table-of-contents .tc-tabbed-table-of-contents-content {
	display: inline-block;
	vertical-align: top;
	padding-left: 1.5em;
	padding-right: 1.5em;
	border: 1px solid #cccccc;
	-webkit-flex: 1 0 50%;
	flex: 1 0 50%;
}/*
** Dirty indicator
*/body.tc-dirty span.tc-dirty-indicator, body.tc-dirty span.tc-dirty-indicator svg {
	fill: #ff0000;
	color: #ff0000;
}/*
** File inputs
*/.tc-file-input-wrapper {
	position: relative;
	overflow: hidden;
	display: inline-block;
	vertical-align: middle;
}.tc-file-input-wrapper input[type=file] {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	font-size: 999px;
	max-width: 100%;
	max-height: 100%;
	filter: alpha(opacity=0);
	opacity: 0;
	outline: none;
	background: white;
	cursor: pointer;
	display: inline-block;
}/*
** Thumbnail macros
*/.tc-thumbnail-wrapper {
	position: relative;
	display: inline-block;
	margin: 6px;
	vertical-align: top;
}.tc-thumbnail-right-wrapper {
	float:right;
	margin: 0.5em 0 0.5em 0.5em;
}.tc-thumbnail-image {
	text-align: center;
	overflow: hidden;
	border-radius: 3px;
}.tc-thumbnail-image svg,
.tc-thumbnail-image img {
	filter: alpha(opacity=1);
	opacity: 1;
	min-width: 100%;
	min-height: 100%;
	max-width: 100%;
}.tc-thumbnail-wrapper:hover .tc-thumbnail-image svg,
.tc-thumbnail-wrapper:hover .tc-thumbnail-image img {
	filter: alpha(opacity=0.8);
	opacity: 0.8;
}.tc-thumbnail-background {
	position: absolute;
	border-radius: 3px;
}.tc-thumbnail-icon svg,
.tc-thumbnail-icon img {
	width: 3em;
	height: 3em;
	
  -webkit-filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
     -moz-filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
          filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));

}.tc-thumbnail-wrapper:hover .tc-thumbnail-icon svg,
.tc-thumbnail-wrapper:hover .tc-thumbnail-icon img {
	fill: #fff;
	
  -webkit-filter: drop-shadow(3px 3px 4px rgba(0,0,0,0.6));
     -moz-filter: drop-shadow(3px 3px 4px rgba(0,0,0,0.6));
          filter: drop-shadow(3px 3px 4px rgba(0,0,0,0.6));

}.tc-thumbnail-icon {
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	display: -webkit-flex;
	-webkit-align-items: center;
	-webkit-justify-content: center;
	display: flex;
	align-items: center;
	justify-content: center;
}.tc-thumbnail-caption {
	position: absolute;
	background-color: #777;
	color: #fff;
	text-align: center;
	bottom: 0;
	width: 100%;
	filter: alpha(opacity=0.9);
	opacity: 0.9;
	line-height: 1.4;
	border-bottom-left-radius: 3px;
	border-bottom-right-radius: 3px;
}.tc-thumbnail-wrapper:hover .tc-thumbnail-caption {
	filter: alpha(opacity=1);
	opacity: 1;
}/*
** Errors
*/.tc-error {
	background: #f00;
	color: #fff;
}


</style>
</head>
<body class="tc-body">

<section class="tc-story-river">
<p>
<a name="Intro">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
Intro
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 10:05pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Pairing is finishes in:
<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunPairingAuthFSM">RocheData/Transport:runPairingAuthFSM</a>
there the biometrics driver of <a class="tc-tiddlylink tc-tiddlylink-missing" href="#DiAs">DiAs</a> gets updated</p><p>Missing parts: 
most urgent: </p><ol><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication">RocheData/Application</a> there all the fun is on the app layer (2870 lines of fun)</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a> contains packet declarations and utility funcs?</li></ol><p>maybe need to know:</p><ol><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDB">RocheDriver/RocheDB</a> gets all history/event data from driver</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver">RocheDriver/RocheDriver</a> seems like <a class="tc-tiddlylink tc-tiddlylink-missing" href="#DiAs">DiAs</a> main interface, has checkLimits function, does custom intend listening</li></ol><p>other stuff (not expected to be of interest):</p><ol><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FKey">RocheData/Key</a> not needed, just calculation for temp pin code</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket">RocheData/Packet</a> not needed, straight forward frmae encoding</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FRochePacket">RocheData/RochePacket</a> just packet wrapper</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FRTConstants">RocheData/RTConstants</a>Â not much, only some parsing for pump display</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity">RocheData/Security</a> CRC calculations, not very interesting</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment">RocheDriver/DiscoveryFragment</a> UI for connecting to pump</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FLogFragement">RocheDriver/LogFragement</a> history view for <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDB">RocheDriver/RocheDB</a></li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheUI">RocheDriver/RocheUI</a> looks like main interface of roche app</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRTFragment">RocheDriver/RTFragment</a> display for the rt command interface, gets updated from somewhere (all is public), but its more or less empty, maybe implemented in other src package</li><li><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment">RocheDriver/SetupFragment</a> same as <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRTFragement">RocheDriver/RTFragement</a></li></ol><p>Done stuff:</p><ol><li><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport">RocheData/Transport</a> transport layer and base pairing</li><li><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn">RocheDriver/BluetoothConn</a> serial connection to pump, handling of pairing /search/conection</li><li><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData">RocheDriver/InterfaceData</a> not much, queue for message and holder of bt Conn to pump</li></ol></div>


</div>


</a><a name="RocheData/Transport">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 3rd May 2017 at 2:11pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Some interesting constants<br><br><em> TX/RX  packet buffer sizes
	private static final short NUM_DELIMITERS                = 2;           	</em> two delimter bytes one at the start of packet, and one at the end<br>	private static final byte MIN_PACKET_SIZE               = 28;      			<em> PACKET_HEADER_SIZE + AUTHEN_SIZE + NUM_DELIMITERS

	</em> Packets field sizes<br>	private static final byte DM_CLIENT_ID_SIZE       = 4;    			<em> # bytes in DM client ID
	private static final byte DM_DEVICE_ID_SIZE       = 13;   			</em> # bytes in DM device ID<br>	private static final byte ID_REQ_PAYLOAD_SIZE     = (byte) (DM_DEVICE_ID_SIZE +  DM_CLIENT_ID_SIZE);   		<em> # bytes in ID request payload
	private static final byte CRC_SIZE                = 2;       	</em> # bytes in CRC<br>	private static final byte VERSION                 = 0x10;    	<em> frame version:  major- bits 7 -4, minor bits 3 -0

	</em> Pump commands/responses<br>	public static final byte A_CON_REQ               	= 0x09;<br>	public static final byte A_KEY_REQ               	= 0x0C;<br>	public static final byte A_ID_REQ                	= 0x12;<br>	public static final byte A_KEY_AVA               	= 0x0F;<br>	public static final byte SYN                     	= 0x17;<br>	public static final byte CONNECT_ACCEPTED         	= 0x0A;<br>	public static final byte KEY_RESPONSE             	= 0x11;<br>	public static final byte ID_RESPONSE              	= 0x14;<br>	public static final byte SYN_ACK                  	= 0x18;<br>	public static final byte DISCONNECT               	= 0x1B;<br>	public static final byte ACK_RESPONSE             	= 0x05;<br>	public static final byte UNRELIABLE_DATA          	= 0x03;<br>	public static final byte RELIABLE_DATA            	= 0x23;<br>	public static final byte ERROR_RESPONSE           	= 0x06;<br><br>	<em> Failure incrementing nonce
	private static final byte NONCE_INC_FAILED  = (byte) 0xFF;

more constamts:
private byte[] connect_pair_authenticate =
	{    
	</em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code<br>	        VERSION    ,                   A_CON_REQ                                ,       CRC_SIZE,0,                     (byte) 0xF0<br>	};<br>	private byte[] key_request =<br>	{<br>	<em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code
	        VERSION    ,                   A_KEY_REQ                                ,       CRC_SIZE,0,                     (byte) 0xF0
	};
	private byte[] key_available =
	{
	</em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code<br>	        VERSION    ,                   A_KEY_AVA                                ,       CRC_SIZE,0,                     (byte) 0xF0<br>	};<br>	private byte[] device_id =<br>	{<br>	<em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code
	        VERSION    ,                   A_ID_REQ                                 ,       ID_REQ_PAYLOAD_SIZE,0,           0
	};
	private byte[] disconnect =
	{
	</em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits MSB LSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code<br>	        VERSION    ,                   DISCONNECT                               ,       0,0,                             0<br>	};<br>	private byte[] connect_normal =<br>	{<br>	<em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code
	        VERSION    ,                   SYN                                      ,       0,0,                             0
	};
	private byte[] ack =
	{
	</em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code<br>	        VERSION    ,                   ACK_RESPONSE                             ,       0,0,                             0<br>	};<br>	private byte[] data_packet =<br>	{<br>	<em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code
	        VERSION    ,                   UNRELIABLE_DATA                          ,       0,0,                             0
	};
	private byte[] error_message =
	{
	</em> VERSION: 8 bits \ Seq#: 1 bit Res1: 1 bit(unused) REL: 1 bit  Command: 5 bits\ length: 16 bits LSB MSB\Source addr: 4 bits Dest addr: 4 bits\ Nonce: 104 bits\ Payload: \ Authentication Code<br>	        VERSION    ,                   ERROR_RESPONSE                           ,       1,0,                             0<br>	};<br>	<br>	public static final int SEND_CONNECT_PAIR_AUTHENTICATE = 0;<br>	public static final int SEND_KEY_REQUEST = 1;<br>	public static final int SEND_KEY_AVAILABLE = 2;<br>	public static final int SEND_ID_REQUEST = 3;<br>	public static final int SEND_SYN = 4;<br>	public static final int SEND_RELIABLE_DATA = 5;<br>	public static final int SEND_ACK = 6;<br>	public static final int SEND_UNRELIABLE_DATA = 7;<br><br>and some stuff:<br>public Security s = new Security();<br>	public Packet p = new Packet();<br>	public Key k = new Key();<br>	<br>	private Driver drv;<br>	private Handler handler;</p></div>


</div>


</a><a name="RocheData/Transport:addTxPacket">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:addTxPacket
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:02pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>List<Byte> in, 
boolean reliable, 
byte seq, 
String s

Code:
byte[] out = new byte[in.size()];
		
		for(int i=0;i&lt;out.length;i++)		<em>Stupid conversion to byte[]
			out[i] = in.get(i);
		
		<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OutPacket">OutPacket</a> op = drv.new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FTransport%2FOutPacket%3AOutPacket">RocheData/Transport/OutPacket:OutPacket</a>(out, reliable, s, seq);
		
		txMessages.offer(op);</em></Byte></p></div>


</div>


</a><a name="RocheData/Transport:adjustLength">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:adjustLength
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:49pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>List<Byte> packet, 
int length

Code:
packet.set(2, (byte) (length &amp; 0xFF));
packet.set(3, (byte) (length &gt;&gt; 8));</Byte></p></div>


</div>


</a><a name="RocheData/Transport:finishPairingAuthentication">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:finishPairingAuthentication
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:28pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>final String FUNC_TAG = &quot;finishPairingAuthentication&quot;;<br><br>		if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.P3_BINDING)<br>			<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_SYN_DIS);<br>		else<br>			Debug.i(TAG, FUNC_TAG, &quot;Not in binding state, cannot complete P&amp;A!&quot;);<br>		<br>		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();</p></div>


</div>


</a><a name="RocheData/Transport:getState">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:getState
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:29pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>return state;</p></div>


</div>


</a><a name="RocheData/Transport:getStateString">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:getStateString
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:24pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>int st<br><br>Code:<br>switch(st)<br>		{<br>			case P1_CONNECT: return &quot;P1_CONNECT&quot;;<br>			case P1_AWAIT_CONNECT_RESP: return &quot;P1_AWAIT_CONNECT_RESP&quot;;<br>			case P1_KEY_AVA: return &quot;P1_KEY_AVA&quot;;<br>			case P1_AWAIT_KEY_RESP: return &quot;P1_AWAIT_KEY_RESP&quot;;<br>			case P2_ID_REQ: return &quot;P2_ID_REQ&quot;;<br>			case P2_AWAIT_ID_RESP: return &quot;P2_AWAIT_ID_RESP&quot;;<br>			case P3_SYN: return &quot;P3_SYN&quot;;<br>			case P3_SYN_ACK: return &quot;P3_SYN_ACK&quot;;<br>			case P3_APP_CONNECT: return &quot;P3_APP_CONNECT&quot;;<br>			case P3_BINDING: return &quot;P3_BINDING&quot;;<br>			case P3_SYN_DIS: return &quot;P3_SYN_DIS&quot;;<br>			case P3_SYN_DIS_RESP: return &quot;P3_SYN_DIS_RESP&quot;;<br>			case P3_APP_DISCONNECT: return &quot;P3_APP_DISCONNECT&quot;;<br>	<br>			case P_A_COMPLETE: return &quot;P_A_COMPLETE&quot;;<br>			case CONNECTED: return &quot;CONNECTED&quot;;<br>			case DISCONNECTED: return &quot;DISCONNECTED&quot;;<br>			<br>			case SERVICE_CON: return &quot;SERVICE_CON&quot;;<br>			case CM_SYN: return &quot;CM_SYN&quot;;<br>			case CM_SYN_RESP: return &quot;CM_SYN_RESP&quot;;<br>			case CM_SYN_ACKD: return &quot;CM_SYN_ACKD&quot;;<br>			<br>			default: return &quot;UNKNOWN&quot;;<br>		}</p></div>


</div>


</a><a name="RocheData/Transport:incrementRxNonce">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:incrementRxNonce
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:22pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AincrementArray">RocheData/Packet:incrementArray</a>(Packet.nonceRx);</p></div>


</div>


</a><a name="RocheData/Transport:incrementTxNonce">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:incrementTxNonce
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:21pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AincrementArray">RocheData/Packet:incrementArray</a>(Packet.nonceTx);</p></div>


</div>


</a><a name="RocheData/Transport:parsePacket">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:parsePacket
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:21pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>List&lt;Byte&gt; packet<br><br>Code:<br>byte[] buf = new byte[packet.size()];<br>		<br>		for(int i=0;i&lt;buf.length;i++)<br>			buf[i] = packet.get(i);<br>			<br>		<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a> buffer = <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a>.wrap(buf);<br>		buffer.order(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteOrder">ByteOrder</a>.LITTLE_ENDIAN);<br>		<br>		<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RochePacket">RochePacket</a> p = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FTransport%2FRochePacket%3ARochePacket">RocheData/Transport/RochePacket:RochePacket</a>(buffer);<br>		<br>		return p;</p></div>


</div>


</a><a name="RocheData/Transport:parseRx">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:parseRx
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:19pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>List&lt;Byte&gt; packet, <br>boolean rel<br><br>Code:<br>Byte command = (byte) (packet.get(1) &amp; 0x1F);<br>		boolean expected = false;<br>		String descrip = &quot;&quot;;<br>		<br>		<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FRochePacket">RocheData/RochePacket</a> p = drv.t.<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AparsePacket">RocheData/Transport:parsePacket</a>(packet);<br>		<br>		byte seq = 0x00;<br>		if((packet.get(1) &amp; 0x80)==0x80)<br>			seq = (byte) 0x80;<br>		else<br>			seq = (byte) 0x00;<br>		<br>		switch(command)<br>		{<br>			case Transport.CONNECT_ACCEPTED:	/****************************************************************************************/<br>				<br>				descrip = &quot;CONNECT_ACCEPTED&quot;;<br>				<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_KEY_REQUEST, null, &quot;&quot;);<br>				<br>				<em>POST ALERT FOR ENTERING 10-DIGIT KEY
				
				</em>Turn off timeout timer for connection start<br>				if(Driver.timeoutTimer != null)<br>					Debug.i(TAG, FUNC_TAG, &quot;Timeout timer: &quot;+Driver.timeoutTimer.cancel(true));<br>				<br>				handler.post(new Runnable()														<br>				{<br>					public void run()<br>					{<br>						<a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.Builder alert = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.Builder(drv.ui);<br>						final <a class="tc-tiddlylink tc-tiddlylink-missing" href="#EditText">EditText</a> input = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#EditText">EditText</a>(drv.ui);<br>				    	input.setInputType(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InputType">InputType</a>.TYPE_CLASS_NUMBER);<br>				    	<br>				    	alert.setTitle(&quot;Passkey Entry&quot;);<br>						alert.setMessage(&quot;Please enter 10-digit key from the pump screen:&quot;);<br>						alert.setCancelable(false);<br>						alert.setView(input);<br>						<br>						alert.setPositiveButton(&quot;OK&quot;, new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#DialogInterface">DialogInterface</a>.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OnClickListener">OnClickListener</a>() {<br>							public void onClick(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#DialogInterface">DialogInterface</a> dialog, int whichButton) {<br>							<br>							}<br>						});<br>						final <a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a> dialog = alert.create();<br>						dialog.show();<br>						<br>						dialog.getButton(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.BUTTON_POSITIVE).setOnClickListener(new View.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OnClickListener">OnClickListener</a>()<br>						{            <br>					          <br>					          public void onClick(View v) {<br>						        	String key = input.getText().toString();<br>									<br>									if((!<a class="tc-tiddlylink tc-tiddlylink-missing" href="#TextUtils">TextUtils</a>.isEmpty(key))&amp;&amp;(key.length() == 10))<br>									{<br>										Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; &quot;+key);<br>										<br>										drv.k_10 = k.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FKey%3AgenerateKey">RocheData/Key:generateKey</a>(key); <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>										<br>										String d = &quot;&quot;;<br>										for(byte b:drv.k_10)<br>											d += String.format(&quot;%02X &quot;, b);<br>										Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; K_10: &quot;+d);<br>										<br>										if(getState() == Transport.P1_AWAIT_CONNECT_RESP)<br>										{<br>											<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_KEY_AVA);<br>											<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();<br>										}<br>										dialog.dismiss();<br>									}<br>						            else<br>						            {<br>						            	Toast.makeText(input.getContext(), &quot;The key must be 10-digit long.&quot;, Toast.LENGTH_SHORT).show();<br>									}<br>							  }<br>					      });<br>					}<br>				});<br>				<br>				break;<br>			case Transport.KEY_RESPONSE:		/****************************************************************************************/<br>				<br>				descrip = &quot;KEY_RESPONSE&quot;;<br>				<br>				if(p != null)<br>				{<br>					Object weak_session = null;<br>					<br>					try <br>					{<br>						<em>CREATE THE WEAK KEY OBJECT WITH THE 10 DIGIT WEAK KEY	
						weak_session = Twofish_Algorithm.makeKey(drv.k_10);
					} 
					catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InvalidKeyException">InvalidKeyException</a> e) 
					{
						e.printStackTrace();
					}
						
					if(drv.t.s.ccmVerify(p, weak_session, p.umac) &amp;&amp; weak_session != null)
					{
						</em>DECRYPT THE 128-BIT KEYS WITH THE WEAK KEY<br>						<br>						drv.addresses = (byte)((p.addresses &amp;lt;&amp;lt; 4) &amp; 0xF0);		<em>Get the address and reverse it since source and destination are reversed from the RX packet
						
						byte[] key_pd = new byte[16];							</em>Get the bytes for the keys<br>						byte[] key_dp = new byte[16];<br>						<br>						p.pBuf.rewind();<br>						p.pBuf.get(key_pd, 0, key_pd.length);<br>						p.pBuf.get(key_dp, 0, key_dp.length);<br>						<br>						String d = &quot;&quot;;<br>						for(byte b:key_pd)<br>							d += String.format(&quot;%02X &quot;, b);<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; Key_PD: &quot;+d);<br>						<br>						d = &quot;&quot;;<br>						for(byte b:key_dp)<br>							d += String.format(&quot;%02X &quot;, b);<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; Key_DP: &quot;+d);<br>						<br>						byte[] key_pd_de = Twofish_Algorithm.blockDecrypt(key_pd, 0, weak_session);<br>						byte[] key_dp_de = Twofish_Algorithm.blockDecrypt(key_dp, 0, weak_session);<br>						<br>						<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsaveKeysToPrefs">RocheData/Transport:saveKeysToPrefs</a>(key_pd_de, key_dp_de);<br>						<br>						d = &quot;&quot;;<br>						for(byte b:key_pd_de)<br>							d += String.format(&quot;%02X &quot;, b);<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; Decrytped PD: &quot;+d);<br>						<br>						d = &quot;&quot;;<br>						for(byte b:key_dp_de)<br>							d += String.format(&quot;%02X &quot;, b);<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; Decrytped DP: &quot;+d);<br>						<br>						<em>CREATE THE KEY OBJECTS (WHITENING SUBKEYS, ROUND KEYS, S-BOXES)
						try 
						{
							drv.pd_key = Twofish_Algorithm.makeKey(key_pd_de);
							drv.dp_key = Twofish_Algorithm.makeKey(key_dp_de);
						} 
						catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InvalidKeyException">InvalidKeyException</a> e) 
						{
							e.printStackTrace();
						}
						
						if(getState() == Transport.P1_AWAIT_KEY_RESP)
						{
							<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P2_ID_REQ);
						}
					}
					else
					{
						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; KEY_RESPONSE Verification Failed!&quot;);	
						
						handler.post(new Runnable(){
							public void run() {
								<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_AWAIT_CONNECT_RESP);
								
								</em>drv.resetDriver();<br>								<a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.Builder alert = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.Builder(drv.ui);<br>								final <a class="tc-tiddlylink tc-tiddlylink-missing" href="#EditText">EditText</a> input = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#EditText">EditText</a>(drv.ui);<br>						    	input.setInputType(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InputType">InputType</a>.TYPE_CLASS_NUMBER);<br>						    	<br>						    	alert.setTitle(&quot;Passkey Entry&quot;);<br>								alert.setMessage(&quot;Please enter 10-digit key from the pump screen:&quot;);<br>								alert.setCancelable(false);<br>								alert.setView(input);<br>								<br>								alert.setPositiveButton(&quot;OK&quot;, new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#DialogInterface">DialogInterface</a>.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OnClickListener">OnClickListener</a>() {<br>									public void onClick(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#DialogInterface">DialogInterface</a> dialog, int whichButton) {<br>									<br>									}<br>								});<br>								final <a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a> dialog = alert.create();<br>								dialog.show();<br>								<br>								dialog.getButton(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#AlertDialog">AlertDialog</a>.BUTTON_POSITIVE).setOnClickListener(new View.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OnClickListener">OnClickListener</a>()<br>								{            <br>							          <br>							          public void onClick(View v) {<br>								        	String key = input.getText().toString();<br>											<br>											if((!<a class="tc-tiddlylink tc-tiddlylink-missing" href="#TextUtils">TextUtils</a>.isEmpty(key))&amp;&amp;(key.length() == 10))<br>											{<br>												Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; &quot;+key);<br>												<br>												drv.k_10 = k.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FKey%3AgenerateKey">RocheData/Key:generateKey</a>(key);<br>												<br>												String d = &quot;&quot;;<br>												for(byte b:drv.k_10)<br>													d += String.format(&quot;%02X &quot;, b);<br>												Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; K_10: &quot;+d);<br>												<br>												if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.P1_AWAIT_CONNECT_RESP)<br>												{<br>													<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_KEY_AVA);<br>													<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();<br>												}<br>												dialog.dismiss();<br>											}<br>								            else<br>								            {<br>								            	Toast.makeText(input.getContext(), &quot;The key must be 10-digit long.&quot;, Toast.LENGTH_SHORT).show();<br>											}<br>									  }<br>							      });<br>							}<br>						});<br>						return;<br>					}<br>				}<br>				break;<br>			case Transport.ID_RESPONSE:			/****************************************************************************************/<br>				<br>				descrip = &quot;ID_RESPONSE&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>						byte[] device = new byte[13];<br>						<br>						p.pBuf.order(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteOrder">ByteOrder</a>.LITTLE_ENDIAN);<br>						drv.serverId = p.pBuf.getInt();<br>						p.pBuf.get(device);<br>						drv.deviceId = new String(device);<br>						<br>						Debug.i(TAG, FUNC_TAG, &quot;Server ID: &quot;+String.format(&quot;%X&quot;, drv.serverId)+&quot; Device ID: &quot;+drv.deviceId);<br>						<br>						if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.P2_AWAIT_ID_RESP)<br>							<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_SYN);<br>					}<br>					else<br>					{<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; ID_RESPONSE Verification Failed!&quot;);<br>					}<br>				}<br>				break;<br>				<br>			case Transport.SYN_ACK:				/****************************************************************************************/<br>				<br>				descrip = &quot;SYN_ACK&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>						if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.P3_SYN_ACK)<br>						{<br>							drv.seqNo = 0x00;<br>							<br>							Debug.i(TAG, FUNC_TAG, &quot;Sequence Number reset!&quot;);<br>							Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; Sending APP_SEND_CONNECT!&quot;);<br>							<br>							if(Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AgetMode">RocheDriver/Driver:getMode</a>() == Driver.PAIRING_AUTH)<br>								<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_APP_CONNECT);<br>						}<br>						else if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.P3_SYN_DIS_RESP)<br>						{<br>							Debug.i(TAG, FUNC_TAG, &quot;Resetting TX layer of pump after binding...&quot;);<br>							<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_APP_DISCONNECT);<br>						}<br>						else if(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>() == Transport.CM_SYN_RESP)<br>						{<br>							<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.CM_SYN_ACKD);<br>						}<br>					}<br>					else<br>					{<br>						Debug.i(TAG, FUNC_TAG, &quot;parseRx &amp;gt;&amp;gt;&amp;gt; SYN_ACK Verification Failed!&quot;);<br>					}<br>				}<br>				break;<br>				<br>			case Transport.DISCONNECT:			/****************************************************************************************/<br>				<br>				descrip = &quot;DISCONNECT&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>					}<br>				}<br>				<br>				break;<br>				<br>			case Transport.ACK_RESPONSE:		/****************************************************************************************/<br>				<br>				descrip = &quot;ACK_RESPONSE&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>					}<br>				}<br>				<br>				break;<br>				<br>			case Transport.RELIABLE_DATA:		/****************************************************************************************/<br>			case Transport.UNRELIABLE_DATA:		/****************************************************************************************/<br>				<br>				if(rel)<br>				{<br>					<em>if(seq != expectedSeq)
					</em>	expected = false;<br>					<br>					descrip = &quot;RELIABLE_DATA&quot;;<br>				}<br>				else<br>					descrip = &quot;UNRELIABLE_DATA&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>						Application.appMessages.offer(drv.new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FTransport%2FInPacket%3AInPacket">RocheData/Transport/InPacket:InPacket</a>(p.payload, rel)); <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication">RocheData/Application</a><br>					}<br>				}<br>				<br>				break;<br>				<br>			case Transport.ERROR_RESPONSE:		/****************************************************************************************/<br>				<br>				descrip = &quot;ERROR_RESPONSE&quot;;<br>				<br>				if(p != null)<br>				{<br>					if(drv.t.s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmVerify">RocheData/Security:ccmVerify</a>(p, drv.pd_key, p.umac))<br>					{<br>						byte error = 0;<br>						String err = &quot;&quot;;<br>						<br>						if(p.payload.length &amp;gt; 0)<br>							error = p.payload[0]; <br>						<br>						switch(error)<br>						{<br>							case 0x00:<br>								err = &quot;Undefined&quot;;<br>								break;<br>							case 0x0F:<br>								err = &quot;Wrong state&quot;;<br>								drv.a.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3AstartMode">RocheData/Application:startMode</a>(Driver.COMMAND, true);<br>								Debug.e(TAG, FUNC_TAG, &quot;Forcing starting of command mode, since the transport layer broke!&quot;);<br>								break;<br>							case 0x33:<br>								err = &quot;Invalid service primitive&quot;;<br>								break;<br>							case 0x3C:<br>								err = &quot;Invalid payload length&quot;;<br>								break;<br>							case 0x55:<br>								err = &quot;Invalid source address&quot;;<br>								break;<br>							case 0x66:<br>								err = &quot;Invalid destination address&quot;;<br>								break;<br>						}<br>						<br>						Debug.e(TAG, FUNC_TAG, &quot;Error in Transport Layer! (&quot;+err+&quot;)&quot;);<br>						Driver.log(&quot;ROCHE&quot;, FUNC_TAG, &quot;Error in Transport Layer! (&quot;+err+&quot;)&quot;);<br>					}<br>				}<br>				<br>				break;<br>				<br>			default:							/****************************************************************************************/<br>				<br>				descrip = &quot;UNKNOWN TRANSPORT PACKET!  ID: &quot;+String.format(&quot;%X&quot;, command);<br>				<br>				break;<br>		}<br>		<br>		Debug.i(TAG, FUNC_TAG, &quot;Receiving: &quot;+descrip+&quot; | Seq No: &quot;+String.format(&quot;%X&quot;, seq) +&quot; | Length: &quot;+ packet.size() + ((expected) ? &quot; | IGNORED&quot; : &quot;&quot;));<br>		<br>		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();</p></div>


</div>


</a><a name="RocheData/Transport:processRx">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:processRx
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:11pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Param:<br>byte[] buffer<br><br>Code:<br>boolean rel = false;<br>		<br>		List&lt;Byte&gt; bufList = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ArrayList">ArrayList</a>&lt;Byte&gt;();<br>		for(int i=0;i&lt;buffer.length;i++)<br> bufList.add(buffer[i]);<br>		<br>		List&lt;List&lt;Byte&gt;&gt; complete = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeDeEscaping">RocheData/Packet:frameDeEscaping</a>(bufList);<br>		<br>		for(List&lt;Byte&gt; p:complete)<br>		{<br>			if(p != null &amp;&amp; p.size() &gt;= (MIN_PACKET_SIZE-NUM_DELIMITERS))<br>			{								<br>				if((p.get(1) &amp; 0x20) == 0x20)<br>				{<br>					rel = true;<br>					<br>					byte seq = 0x00;<br>					if((p.get(1) &amp; 0x80)==0x80)<br>						seq = (byte) 0x80;<br>					<br>					drv.recvSeqNo = seq; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>					<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_ACK, null, &quot;&quot;);				Send ACK right away<br>				}<br>				else<br>				{<br>					rel = false;<br>				}<br>				<br>				Driver.stats.rxPackets++; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AparseRx">RocheData/Transport:parseRx</a>(p, rel);<br>			}<br>			else<br>				Driver.stats.skippedPackets++; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>		}</p></div>


</div>


</a><a name="RocheData/Transport:runFSM">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:runFSM
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:32pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>switch(Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AgetMode">RocheDriver/Driver:getMode</a>())<br>		{<br>			case Driver.PAIRING_AUTH:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunPairingAuthFSM">RocheData/Transport:runPairingAuthFSM</a>();<br>				break;<br>			case Driver.COMMAND:<br>			case Driver.RT:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunModeFSM">RocheData/Transport:runModeFSM</a>();<br>				break;<br>			case Driver.IDLE:<br>				break;<br>			case Driver.NONE:<br>			default:<br>				break;<br>		}</p></div>


</div>


</a><a name="RocheData/Transport:runModeFSM">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:runModeFSM
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:34pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>switch(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>())<br>		{<br>			case CM_SYN:<br>				Debug.i(TAG, FUNC_TAG, &quot;Sending SYN command!&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_SYN, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(CM_SYN_RESP);<br>				break;<br>			case CM_SYN_ACKD:<br>				Debug.i(TAG, FUNC_TAG, &quot;Sending SYN ACK signal!&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(SERVICE_CON);<br>				drv.a.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3AsynAckd">RocheData/Application:synAckd</a>();<br>				break;<br>		}</p></div>


</div>


</a><a name="RocheData/Transport:runPairingAuthFSM">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:runPairingAuthFSM
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:39pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>switch(<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetState">RocheData/Transport:getState</a>())<br>		{<br>			case P1_CONNECT:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_CONNECT_PAIR_AUTHENTICATE, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_AWAIT_CONNECT_RESP);<br>				break;<br>			case P1_KEY_AVA:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_KEY_AVAILABLE, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_AWAIT_KEY_RESP);<br>				break;<br>			case P2_ID_REQ:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_ID_REQUEST, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P2_AWAIT_ID_RESP);<br>				break;<br>			case P3_SYN:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_SYN, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_SYN_ACK);<br>				break;<br>			case P3_APP_CONNECT:<br>				drv.a.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3AstartP3">RocheData/Application:startP3</a>();				<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_BINDING);<br>				break;<br>			case P3_SYN_DIS:<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_SYN, null, &quot;&quot;);<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P3_SYN_DIS_RESP);<br>				break;<br>			case P3_APP_DISCONNECT:<br>				Debug.i(TAG, FUNC_TAG, &quot;Telling Application layer to disconnect...&quot;);<br>				drv.a.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3AdisconnectAppLayer">RocheData/Application:disconnectAppLayer</a>();<br>				if(Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AgetMode">RocheDriver/Driver:getMode</a>() == Driver.PAIRING_AUTH)<br>				{	<br>					Debug.i(TAG, FUNC_TAG, &quot;Pairing and authentication complete!  Overall state set to IDLE!&quot;);<br>					<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P_A_COMPLETE);<br>					<br>					<em>Delay this execution so the UI doesn't prematurely send the start for Command mode
					handler.postDelayed(new Runnable(){
						public void run() {
							Debug.e(TAG, FUNC_TAG, &quot;Setting mode to idle...&quot;);
							Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AsetMode">RocheDriver/Driver:setMode</a>(Driver.IDLE);
							drv.a.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3AstartMode">RocheData/Application:startMode</a>(Driver.COMMAND, false);
						}
					}, 5000);
					
					<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ContentValues">ContentValues</a> dv = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ContentValues">ContentValues</a>();

					Debug.e(&quot;Application&quot;, FUNC_TAG, &quot;Adding to running pump DB value!&quot;);
					dv.put(&quot;running_pump&quot;, &quot;edu.virginia.dtc.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver">RocheDriver</a>.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver">RocheDriver</a>&quot;);					
					
					Debug.w(&quot;Application&quot;, FUNC_TAG, &quot;Running pump updated in Hardware Configuration table!&quot;);
					drv.serv.getContentResolver().update(Biometrics.HARDWARE_CONFIGURATION_URI, dv, null, null);
					
					Debug.i(TAG, FUNC_TAG, &quot;Writing keys and MAC address to shared storage!&quot;);
					
					Editor edit = drv.settings.edit();
					
					edit.putInt(&quot;address&quot;, drv.addresses);
					edit.putString(&quot;mac&quot;, drv.deviceMac);
					edit.putBoolean(&quot;paired&quot;, true);
					
					edit.commit();
				}
				break;
		}</em></p></div>


</div>


</a><a name="RocheData/Transport:saveKeysToPrefs">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:saveKeysToPrefs
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:22pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>byte[] pd, <br>byte[] dp<br><br>Code:<br>Editor edit = drv.settings.edit();<br>		<br>		for(int i=0;i&lt;pd.length;i++)<br>		{<br>			edit.putInt(&quot;pd&quot;+i, pd[i]);<br>		}<br>		<br>		for(int i=0;i&lt;dp.length;i++)<br>		{<br>			edit.putInt(&quot;dp&quot;+i, dp[i]);<br>		}<br>		<br>		edit.commit();</p></div>


</div>


</a><a name="RocheData/Transport:saveNonce">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:saveNonce
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:23pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>Editor edit = drv.settings.edit();<br>		<br>		for(int i=0;i&lt;Packet.nonceTx.length;i++)<br>		{<br>			edit.putInt(&quot;nonce&quot;+i, Packet.nonceTx[i]);<br>		}<br>		<br>		edit.commit();</p></div>


</div>


</a><a name="RocheData/Transport:sendConnect">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:sendConnect
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 3rd May 2017 at 2:12pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br><em>Basically the entry point to system start up, pairing and authentication begins here!
		Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AsetMode">RocheDriver/Driver:setMode</a>(Driver.PAIRING_AUTH);
		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetState">RocheData/Transport:setState</a>(Transport.P1_CONNECT);
		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();</em></p></div>


</div>


</a><a name="RocheData/Transport:sendReliableData">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:sendReliableData
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:54pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a> payload, <br>String commDescrip<br><br>Code:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_RELIABLE_DATA, payload, commDescrip);</p></div>


</div>


</a><a name="RocheData/Transport:sendTransportLayerCommand">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:sendTransportLayerCommand
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:46pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Param:<br>int command<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a> payload<br>String commDescrip<br><br>Code:<br>List&lt;Byte&gt; packet = null;<br>		boolean reliable = true;<br>		String descrip = &quot;Unknown&quot;;<br>		byte seq = (byte) 0xFF;<br>		<br>		switch(command)<br>		{<br>			case SEND_CONNECT_PAIR_AUTHENTICATE:			/************************************************************************/<br>				descrip = &quot;CONNECT_PAIR_AUTH&quot;;<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3A%5B%5BRocheData%2FPacket%3AbuildPacket">RocheData/Packet:[[RocheData/Packet:buildPacket</a>]](connect_pair_authenticate, null, false);<br>				s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3A%5B%5BRocheData%2FSecurity%3AaddCrc">RocheData/Security:[[RocheData/Security:addCrc</a>]](packet);<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3A%5B%5BRocheData%2FPacket%3AframeEscaping">RocheData/Packet:[[RocheData/Packet:frameEscaping</a>]](packet);<br>				break;<br>				<br>			case SEND_KEY_REQUEST:							/************************************************************************/<br>				descrip = &quot;KEY_REQUEST&quot;;<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3A%5B%5BRocheData%2FPacket%3AbuildPacket">RocheData/Packet:[[RocheData/Packet:buildPacket</a>]](key_request, null, false);<br>				s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AaddCrc">RocheData/Security:addCrc</a>(packet);<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);<br>				break;<br>				<br>			case SEND_KEY_AVAILABLE:						/************************************************************************/<br>				descrip = &quot;KEY_AVAIL&quot;;<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3A%5B%5BRocheData%2FPacket%3AbuildPacket">RocheData/Packet:[[RocheData/Packet:buildPacket</a>]](key_available, null, false);<br>				s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AaddCrc">RocheData/Security:addCrc</a>(packet);<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);<br>				break;<br>				<br>			case SEND_ID_REQUEST:							/************************************************************************/<br>				descrip = &quot;ID_REQ&quot;;<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AresetTxNonce">RocheData/Packet:resetTxNonce</a>();														<em>Reset TX Nonce (previous to this the nonce is not used and is zero)
				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AincrementTxNonce">RocheData/Transport:incrementTxNonce</a>();														</em>Increment it to 1<br>				<br>				<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a> ids = <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a>.allocate(17);								<em>Allocate payload
				
				String btName = <a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterfaceData">InterfaceData</a>.<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData%3AgetInstance">RocheDriver/InterfaceData:getInstance</a>().bt.getName();				</em>Get the Device ID<br>				<br>				Debug.i(TAG, FUNC_TAG, &quot;BT Friendly Name: &quot;+btName);<br>				<br>				byte[] deviceId = new byte[13];<br>				for(int i=0;i&lt;deviceId.length;i++)<br>				{<br>					if(i &lt; btName.length())<br>						deviceId[i] = (byte)btName.charAt(i);<br>					else<br>						deviceId[i] = (byte)0x00;<br>				}<br>				<br>				String dat = &quot;&quot;;<br>				for(byte b:deviceId)<br>					dat += String.format(&quot;%02X &quot;, b);<br>				Debug.i(TAG, FUNC_TAG, &quot;Device ID: &quot;+dat);<br>				<br>				String swver = &quot;5.04&quot;;													<em>Get the SW Version
				int clientId = 0;
				
				clientId += (((byte)swver.charAt(3)) - 0x30);			
				clientId += (((byte)swver.charAt(2)) - 0x30)*10;
				clientId += (((byte)swver.charAt(0)) - 0x30)*100;
				clientId += (10000);
				
				Debug.i(TAG, FUNC_TAG, &quot;Client ID: &quot;+String.format(&quot;%X&quot;, clientId));
				
				ids.order(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteOrder">ByteOrder</a>.LITTLE_ENDIAN);
				ids.putInt(clientId);
				ids.put(deviceId);
				
				dat = &quot;&quot;;																</em>Print payload<br>				for(byte b:ids.array())<br>					dat += String.format(&quot;%02X &quot;, b);<br>				Debug.i(TAG, FUNC_TAG, &quot;Payload: &quot;+dat);<br>				<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AbuildPacket">RocheData/Packet:buildPacket</a>(device_id, ids, true);							<em>Use real address (gathered in Key Response)
				packet = s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmAuthenticate">RocheData/Security:ccmAuthenticate</a>(packet, drv.dp_key, Packet.nonceTx);			</em>Add U-MAC (Use D-&gt;P key)<em>FIXME last loc
				
				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);												</em>Escape packet<br>				break;<br>			case SEND_SYN:									/************************************************************************/<br>				descrip = &quot;SYN&quot;;<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AincrementTxNonce">RocheData/Transport:incrementTxNonce</a>();<br>				<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AbuildPacket">RocheData/Packet:buildPacket</a>(connect_normal, null, true);<br>				packet = s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmAuthenticate">RocheData/Security:ccmAuthenticate</a>(packet, drv.dp_key, Packet.nonceTx);<br>				<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);<br>				break;<br>			case SEND_RELIABLE_DATA:						/************************************************************************/<br>				descrip = &quot;RELIABLE_DATA&quot;;<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AincrementTxNonce">RocheData/Transport:incrementTxNonce</a>();<br>				<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AbuildPacket">RocheData/Packet:buildPacket</a>(data_packet, payload, true);					<em>Add the payload, set the address if valid
				
				seq = drv.seqNo; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>
				packet.set(1, <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsetSeqRel">RocheData/Transport:setSeqRel</a>(packet.get(1), true));						</em>Set the sequence and reliable bits<br>				<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AadjustLength">RocheData/Transport:adjustLength</a>(packet, payload.capacity());							<em>Set the payload length
				
				packet = s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmAuthenticate">RocheData/Security:ccmAuthenticate</a>(packet, drv.dp_key, Packet.nonceTx);		</em>Authenticate packet<br>				<br>				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);<br>				break;<br>			case SEND_UNRELIABLE_DATA:<br>				descrip = &quot;UNRELIABLE_DATA&quot;;<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AincrementTxNonce">RocheData/Transport:incrementTxNonce</a>();<br>				<br>				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AbuildPacket">RocheData/Packet:buildPacket</a>(data_packet, payload, true);					<em>Add the payload, set the address if valid
				
				seq = drv.seqNo;<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>
				
				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AadjustLength">RocheData/Transport:adjustLength</a>(packet, payload.capacity());							</em>Set the payload length<br>				<br>				packet = s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmAuthenticate">RocheData/Security:ccmAuthenticate</a>(packet, drv.dp_key, Packet.nonceTx);		<em>Authenticate packet
				
				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);
				break;
			case SEND_ACK:									/************************************************************************/
				descrip = &quot;ACK&quot;;
				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AincrementTxNonce">RocheData/Transport:incrementTxNonce</a>();
				
				packet = p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AbuildPacket">RocheData/Packet:buildPacket</a>(ack, null, true);
				
				</em>drv.recvSeqNo ^= 0x80;<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>				<br>				seq = drv.recvSeqNo;<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>				packet.set(1, (byte) (packet.get(1) | drv.recvSeqNo));	<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>			<em>OR the received sequence number
				
				packet = s.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FSecurity%3AccmAuthenticate">RocheData/Security:ccmAuthenticate</a>(packet, drv.dp_key, Packet.nonceTx); <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a> <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket">RocheData/Packet</a>
				
				p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AframeEscaping">RocheData/Packet:frameEscaping</a>(packet);
				</em>reliable = false;													<em>Use this to make transmission asynchronous (not threaded)
				break;
		}
		
		if(packet != null)
		{
</em>			Debug.i(TAG, FUNC_TAG, &quot;TX Packet Start ---------------------------------â€”&quot;);<br><em>			String dat = &quot;&quot;;
</em>			for(byte b:packet)<br><em>			{
</em>				dat += String.format(&quot;%02X &quot;, b);<br><em>			}
</em>			Debug.i(TAG, FUNC_TAG, dat);<br><em>			Debug.i(TAG, FUNC_TAG, &quot;TX Packet End -----------------------------------â€”&quot;);
		}
		else
			Debug.i(TAG, FUNC_TAG, &quot;Packet is null!&quot;);
		
		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsaveNonce">RocheData/Transport:saveNonce</a>();
		
		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AaddTxPacket">RocheData/Transport:addTxPacket</a>(packet, reliable, seq, descrip + &quot; &quot; + commDescrip);</em></p></div>


</div>


</a><a name="RocheData/Transport:sendUnreliableData">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:sendUnreliableData
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:55pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#ByteBuffer">ByteBuffer</a> payload, <br>String commDescrip<br><br>Code:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a>(Transport.SEND_UNRELIABLE_DATA, payload, commDescrip);</p></div>


</div>


</a><a name="RocheData/Transport:setSeqRel">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:setSeqRel
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:50pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>Byte b, <br>boolean rel<br><br>Code:<br>b = (byte) (b | drv.seqNo); <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>			<em>Set the sequence bit
		
		if(rel)
			b = (byte) (b |0x20);			</em>Set the reliable bit<br>				<br>		<em>Debug.i(TAG, FUNC_TAG, &quot;Byte for Seq and Rel: &quot;+String.format(&quot;%02X&quot;, b));
		
		drv.seqNo ^= 0x80; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>
		
		return b;</em></p></div>


</div>


</a><a name="RocheData/Transport:setState">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:setState
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:31pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>int st<br><br>Code:<br>drv.txFsm = <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AgetStateString">RocheData/Transport:getStateString</a>(st); <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>:<br>		<br>		prevState = state;			<em>Save the previous state
		state = st;					</em>Set new state<br>		<br>		Debug.i(TAG, FUNC_TAG, &quot;setState &gt;&gt;&gt; State: &quot;+state+&quot; Prev: &quot;+prevState);</p></div>


</div>


</a><a name="RocheData/Transport:startReceiveThread">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:startReceiveThread
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 7:55pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(!rxRunning)<br>		{<br>			rxRunning = true;<br>			<br>			receive = new Thread ()<br>			{<br>				public void run ()<br>				{<br>					Debug.i(&quot;Thread&quot;, FUNC_TAG, &quot;RX Thread starting!&quot;);<br>					rxStop = false;<br>				<br>					while(!rxStop)<br>					{<br>						<em> Pump message parsing
						byte[] ip = <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData">RocheDriver/InterfaceData</a>.pumpMessages.poll();		</em>Pulls data directly from <a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothConn">BluetoothConn</a><br>						if(ip != null)<br>						{<br>							Debug.i(&quot;Thread&quot;, FUNC_TAG, &quot;RX Data Received, remaining messages: &quot;+<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterfaceData">InterfaceData</a>.pumpMessages.size());<br>							<br><em>							String s = &quot;&quot;;
</em>							for(byte b:ip)<br><em>								s += String.format(&quot;%02X &quot;, b);
</em>							Debug.i(TAG, FUNC_TAG, &quot;RX Buffer: &quot;+s);<br>							<br>							<em>Process buffer
							drv.t.<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AprocessRx">RocheData/Transport:processRx</a>(ip);
						}
						
						try {
							Thread.sleep(RX_THREAD_SLEEP);
						} catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterruptedException">InterruptedException</a> e) {
							e.printStackTrace();
						}
					}
				}
			};
			
			receive.start();
		}</em></p></div>


</div>


</a><a name="RocheData/Transport:startTransmitThread">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:startTransmitThread
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:33pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>txMessages = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ConcurrentLinkedQueue">ConcurrentLinkedQueue</a>&lt;<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OutPacket">OutPacket</a>&gt;();				<em>Initialize the TX queue
		
		if(!txRunning)
		{
			txRunning = true;
			
			transmit = new Thread ()
			{
				public void run ()
				{
					Debug.i(&quot;Thread&quot;, FUNC_TAG, &quot;TX Thread starting!&quot;);
					txStop = false;
				
					while(!txStop)
					{
						<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%2FOutPacket">RocheDriver/Driver/OutPacket</a> op = txMessages.poll();
						if(op != null)
						{
							Debug.i(&quot;Thread&quot;, FUNC_TAG, &quot;Size of <a class="tc-tiddlylink tc-tiddlylink-missing" href="#TxBuffer">TxBuffer</a>: &quot;+txMessages.size());
							
							drv.command = op.descrip; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>
							Debug.i(TAG, FUNC_TAG, &quot;Transmitting: &quot; + op.descrip + &quot; | Seq No: &quot;+String.format(&quot;%X&quot;,op.sequence) + &quot; | Size of buffer: &quot;+op.packet.length);
							<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData">RocheDriver/InterfaceData</a>.remotePumpBt.write(op.packet);		</em>Write it out<br>							<br>							Driver.stats.txPackets++; <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a><br>						}<br>						<br>						try {<br>							Thread.sleep(TX_THREAD_SLEEP);<br>						} catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterruptedException">InterruptedException</a> e) {<br>							e.printStackTrace();<br>						}<br>					}<br>				}<br>			};<br>			<br>			transmit.start();<br>		}</p></div>


</div>


</a><a name="RocheData/Transport:synAck">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:synAck
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 9:27pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AgetMode">RocheDriver/Driver:getMode</a>() == Driver.COMMAND || Driver.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AgetMode">RocheDriver/Driver:getMode</a>() == Driver.RT)<br>		{<br>			<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2F%2FTransport%3AsetState">RocheData//Transport:setState</a>(Transport.CM_SYN);<br>			<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3ArunFSM">RocheData/Transport:runFSM</a>();<br>		}</p></div>


</div>


</a><a name="RocheData/Transport:Transport">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheData/Transport:Transport
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 8:20pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>Driver driver<br><br>Code:<br>drv = inst;<br>		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData%3AgetInstance">RocheDriver/InterfaceData:getInstance</a>();<br>		<br>		state = <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>.NONE;<br>		prevState = <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver">RocheDriver/Driver</a>.NONE;<br>		<br>		handler = new Handler();<br>		<br>		Debug.i(TAG, &quot;resetDriver&quot;, &quot;Cancelling response timer...&quot;);<br>				<br>		p.<a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FPacket%3AresetPacketLayer">RocheData/Packet:resetPacketLayer</a>();<br>		<br>		Debug.i(TAG, &quot;resetDriver&quot;, &quot;Starting to stop transmit thread!&quot;);<br>		txStop = true;<br>		<em>Close transmit thread
		if(transmit != null)
		{
			if(transmit.isAlive())
			{
				try {
					transmit.join();
					txRunning = false;
				} catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterruptedException">InterruptedException</a> e) {
					e.printStackTrace();
				}
			}
		}
		
		Debug.i(TAG, &quot;resetDriver&quot;, &quot;Starting to stop receive thread!&quot;);
		rxStop = true;
		</em>Close transmit thread<br>		if(receive != null)<br>		{<br>			if(receive.isAlive())<br>			{<br>				try {<br>					receive.join();<br>					rxRunning = false;<br>				} catch (<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterruptedException">InterruptedException</a> e) {<br>					e.printStackTrace();<br>				}<br>			}<br>		}<br>		<br>		Debug.i(TAG, &quot;resetDriver&quot;, &quot;Starting communication threads!&quot;);<br>		<br>		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AstartTransmitThread">RocheData/Transport:startTransmitThread</a>();<br>		<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AstartReceiveThread">RocheData/Transport:startReceiveThread</a>();</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 5:42pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>private String NAME;<br>set by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3ABluetoothConn">RocheDriver/BluetoothConn:BluetoothConn</a><br>used by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3AListenThread">RocheDriver/BluetoothConn/ListenThread:ListenThread</a><br><br>private UUID UUID_SECURE;<br>set by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3ABluetoothConn">RocheDriver/BluetoothConn:BluetoothConn</a><br>used by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3AConnectThread">RocheDriver/BluetoothConn/ConnectThread:ConnectThread</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3AListenThread">RocheDriver/BluetoothConn/ListenThread:ListenThread</a><br><br>private <a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothAdapter">BluetoothAdapter</a> adapter;<br>set by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3ABluetoothConn">RocheDriver/BluetoothConn:BluetoothConn</a><br>used by<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Arun">RocheDriver/BluetoothConn/ConnectThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3AListenThread">RocheDriver/BluetoothConn/ListenThread:ListenThread</a><br><br>public static final int NONE = 0;<br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Astop">RocheDriver/BluetoothConn:stop</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br><br>public static final int LISTENING = 1;<br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alisten">RocheDriver/BluetoothConn:listen</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br><br>public static final int CONNECTING =2;<br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Aconnect">RocheDriver/BluetoothConn:connect</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br><br>public static final int CONNECTED = 3;<br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Afailed">RocheDriver/BluetoothConn:failed</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alost">RocheDriver/BluetoothConn:lost</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Arunning">RocheDriver/BluetoothConn:running</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Awrite">RocheDriver/BluetoothConn:write</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br><br>private int state;<br>set by:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Aconnect">RocheDriver/BluetoothConn:connect</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alisten">RocheDriver/BluetoothConn:listen</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Arunning">RocheDriver/BluetoothConn:running</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Astop">RocheDriver/BluetoothConn:stop</a><br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Afailed">RocheDriver/BluetoothConn:failed</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alost">RocheDriver/BluetoothConn:lost</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Awrite">RocheDriver/BluetoothConn:write</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br></p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:BluetoothConn">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:BluetoothConn
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 5:42pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothAdapter">BluetoothAdapter</a> bt <br>String uuid<br>String name<br>boolean retry<br></p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:connect">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:connect
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 5:58pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothDevice">BluetoothDevice</a> dev<br>boolean async<br>boolean retry<br><br>Code:<br>stopping = false;<br>		<br>connectRetry = retry;<br>autoRetry = retry;<br>		<br>count++;<br>		<br>if(retrySchedule != null)<br>	retrySchedule.cancel(true);<br>		<br>if(async)			<em>Basically a flag to say whether it comes from the UI or internally
prevDev = dev;	</em>We only want to overwrite the device from the UI, not the retry<br>		<br>if(listen != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Acancel">RocheDriver/BluetoothConn/ListenThread:cancel</a><br>	listen = null;<br>}<br>		<br>if(connect != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Acancel">RocheDriver/BluetoothConn/ConnectThread:cancel</a><br>	connect = null;<br>}<br><br>if(running != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Acancel">RocheDriver/BluetoothConn/RunningThread:cancel</a><br>	running = null;<br>}<br>		<br>connect = <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3AConnectThread">RocheDriver/BluetoothConn/ConnectThread:ConnectThread</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Astart">RocheDriver/BluetoothConn/ConnectThread:start</a><br>		<br>setState(CONNECTING);<br></p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:failed">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:failed
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:09pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(!stopping)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alisten">RocheDriver/BluetoothConn:listen</a>	<br>	Runnable retry = new Runnable()<br>	{<br>		public void run() <br>		{<br>			if(prevDev != null &amp;&amp; state != CONNECTED)<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Aconnect">RocheDriver/BluetoothConn:connect</a>(prevDev, false, true);<br>		}	<br>	};<br>			<br>	if(retrySchedule != null)<br>		retrySchedule.cancel(true);<br>			<br>	if(connectRetry)<br>	{<br>		retrySchedule = scheduler.schedule(retry, RETRY_S, <a class="tc-tiddlylink tc-tiddlylink-missing" href="#TimeUnit">TimeUnit</a>.SECONDS);<br>	}<br>}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:listen">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:listen
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:28pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>if(connect!=null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Acancel">RocheDriver/BluetoothConn/ConnectThread:cancel</a><br>	connect = null;<br>}<br>		<br>if(running != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Acancel">RocheDriver/BluetoothConn/RunningThread:cancel</a><br>	running = null;<br>}<br>		<br>setState(LISTENING);<br>		<br>if(listen == null)<br>{<br>	listen = <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3AListenThread">RocheDriver/BluetoothConn/ListenThread:ListenThread</a><br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Arun">RocheDriver/BluetoothConn/ListenThread:run</a><br>}<br>&quot;&quot;</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:lost">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:lost
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:12pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(!stopping)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alisten">RocheDriver/BluetoothConn:listen</a><br>			<br>	Runnable retry = new Runnable()<br>	{<br>		public void run() <br>		{<br>			if(prevDev != null &amp;&amp; state != CONNECTED)<br>			{<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Aconnect">RocheDriver/BluetoothConn:connect</a>(prevDev, false, true);<br>			}<br>		}	<br>	};<br>			<br>	if(retrySchedule != null)<br>		retrySchedule.cancel(true);<br>			<br>	if(autoRetry)<br>		retrySchedule = scheduler.schedule(retry, RETRY_S, <a class="tc-tiddlylink tc-tiddlylink-missing" href="#TimeUnit">TimeUnit</a>.SECONDS);<br>}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:running">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:running
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 5:57pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothSocket">BluetoothSocket</a> sock<br><br>Code:<br>if(connect != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Acancel">RocheDriver/BluetoothConn/ConnectThread:cancel</a><br>	connect = null;<br>}<br>		<br>if(running != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Acancel">RocheDriver/BluetoothConn/RunningThread:cancel</a><br>	running = null;<br>}<br>		<br>if(listen != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Acancel">RocheDriver/BluetoothConn/ListenThread:cancel</a><br>	listen = null;<br>}<br>		<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3ARunningThread">RocheDriver/BluetoothConn/RunningThread:RunningThread</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Astart">RocheDriver/BluetoothConn/RunningThread:start</a><br>		<br>setState(CONNECTED);<br></p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:stop">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:stop
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:06pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>stopping = true;<br>		<br>if(retrySchedule!=null)<br>	retrySchedule.cancel(true);<br><br>		<br>if(scheduler != null)<br>{<br>	scheduler.shutdown();<br>	scheduler = Executors.newSingleThreadScheduledExecutor();<br>}<br>		<br>if(listen != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FListenThread%3Acancel">RocheDriver/BluetoothConn/ListenThread:cancel</a><br>	listen = null;<br>}<br>				<br>if(connect != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FConnectThread%3Acancel">RocheDriver/BluetoothConn/ConnectThread:cancel</a><br>	connect = null;<br>}<br>			<br>if(running != null)<br>{<br>	<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Acancel">RocheDriver/BluetoothConn/RunningThread:cancel</a><br>	running = null;<br>}<br>		<br>prevDev = null;<br>		<br>connectRetry = false;<br>autoRetry = false;<br>		<br>setState(NONE);<br></p></div>


</div>


</a><a name="RocheDriver/BluetoothConn:write">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn:write
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:08pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>params:<br>byte[] out<br><br>Code:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a> r;<br>synchronized(this)<br>{<br>	if(state != CONNECTED)<br>	{<br>		return false;<br>	}<br>	r = running;<br>}<br>r.write(out);<br>return true;<br><br>Comments:<br>Actual writing something to the running Thread, threadsafe behaviour</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ConnectThread:cancel">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ConnectThread:cancel
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:20pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>try<br>			{<br>				socket.close();<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ConnectThread">ConnectThread</a>: unable to close() during cancel call&quot;);<br>			}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ConnectThread:ConnectThread">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ConnectThread:ConnectThread
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:18pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothDevice">BluetoothDevice</a> dev<br><br>Code:<br>device = dev;<br>			<a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothSocket">BluetoothSocket</a> tmp = null;<br>			try<br>			{<br>				tmp = device.createInsecureRfcommSocketToServiceRecord(UUID_SECURE);<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG,NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ConnectThread">ConnectThread</a>: socket create() failed&quot;);<br>			}<br>			<br>			socket = tmp;</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ConnectThread:run">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ConnectThread:run
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:19pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(adapter.isDiscovering())<br>				adapter.cancelDiscovery();<br>			<br>			try{<br><em>				if(count % 2 == 0)
</em>					socket.close();<br>				<br>				socket.connect();<br>			}<br>			catch(IOException e)<br>			{<br>				if(socket.isConnected())<br>				{<br>					try<br>					{<br>						socket.close();<br>					}<br>					catch(IOException e2)<br>					{<br>						Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ConnectThread">ConnectThread</a>: unable to close() socket&quot;);<br>					}<br>				}<br>				<br>				<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Afailed">RocheDriver/BluetoothConn:failed</a><br>				return;<br>			}<br>			<br>			synchronized(this)<br>			{<br>				connect = null;<br>			}<br>			<br>			<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Arunning">RocheDriver/BluetoothConn:running</a>(socket);</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ListenThread:cancel">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ListenThread:cancel
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:17pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>try{<br>				if(servSock!=null)<br>					servSock.close();<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ListenThread">ListenThread</a>: unable to close() server socket&quot;);<br>			}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ListenThread:ListenThread">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ListenThread:ListenThread
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:14pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothServerSocket">BluetoothServerSocket</a> tmpSock = null;<br>			<br>try<br>{<br>	tmpSock = adapter.listenUsingInsecureRfcommWithServiceRecord(NAME, UUID_SECURE);<br>}<br>catch (IOException e)<br>{<br>	Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ListenThread">ListenThread</a>: socket listen() failed&quot;);<br>}<br>				<br>servSock = tmpSock;</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/ListenThread:run">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/ListenThread:run
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:49pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothSocket">BluetoothSocket</a> socket = null;<br>			while(state != CONNECTED)<br>			{<br>				try<br>				{<br>					if(servSock != null)<br>						socket = servSock.accept();<br>				}<br>				catch(IOException e)<br>				{<br>					break;<br>				}<br>				<br>				if(socket != null)<br>				{<br>					synchronized(this)<br>					{<br>						switch(state)<br>						{<br>							case LISTENING:<br>							case CONNECTING:<br>								<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Arunning">RocheDriver/BluetoothConn:running</a>(socket);<br>								break;<br>							case NONE:<br>							case CONNECTED:<br>								try<br>								{<br>									socket.close();<br>								}<br>								catch(IOException e)<br>								{<br>									Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ListenThread">ListenThread</a>: couldn't close unwanted socket&quot;);<br>								}<br>								break;<br>						}<br>					}<br>				}<br>			}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/RunningThread:cancel">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/RunningThread:cancel
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:25pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>try<br>			{<br>				socket.close();<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: cancelling of socket failed close()&quot;);<br>			}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/RunningThread:run">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/RunningThread:run
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:24pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>byte[] buffer = new byte[1024];<br>			int bytes;<br>			<br>			while(true)<br>			{<br>				try<br>				{<br>					bytes = input.read(buffer);<br>					Debug.i(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: read &quot;+bytes+&quot; bytes&quot;);<br>					String p = &quot;&quot;;<br>					<br>					byte[] out = new byte[bytes];<br>					for(int i=0;i&lt;out.length;i++)<br>						out[i] = buffer[i];<br>					<br>					<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData">RocheDriver/InterfaceData</a>.pumpMessages.offer(out);<br>				}<br>				catch(IOException e)<br>				{<br>					Debug.e(TAG, FUNC_TAG,NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: connection lost, unable to read&quot;);<br>					<a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%3Alost">RocheDriver/BluetoothConn:lost</a><br>					break;<br>				}<br>			}</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/RunningThread:RunningThread">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/RunningThread:RunningThread
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:22pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>socket = sock;<br>			<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InputStream">InputStream</a> tmpInput = null;<br>			<a class="tc-tiddlylink tc-tiddlylink-missing" href="#OutputStream">OutputStream</a> tmpOutput = null;<br>			<br>			try<br>			{<br>				tmpInput = socket.getInputStream();<br>				tmpOutput = socket.getOutputStream();<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: IO sockets not created&quot;);<br>			}<br>			<br>			input = tmpInput;<br>			output = tmpOutput;</p></div>


</div>


</a><a name="RocheDriver/BluetoothConn/RunningThread:write">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/BluetoothConn/RunningThread:write
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 6:25pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Params:<br>byte[] buffer<br><br>Code:<br>try<br>			{<br>				Debug.i(TAG, FUNC_TAG, NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: Writing &quot;+buffer.length+&quot; bytes!&quot;);<br>				output.write(buffer);<br>			}<br>			catch(IOException e)<br>			{<br>				Debug.e(TAG, FUNC_TAG,NAME + &quot;: <a class="tc-tiddlylink tc-tiddlylink-missing" href="#RunningThread">RunningThread</a>: Exception during write process&quot;);<br>			}</p></div>


</div>


</a><a name="RocheDriver/InterfaceData">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/InterfaceData
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 7:47pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>public static final String PUMP_UUID = &quot;00001101-0000-1000-8000-00805f9b34fb&quot;;<br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AresetDriver">RocheDriver/Driver:resetDriver</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3ArestoreDevice">RocheDriver/RocheDriver:restoreDevice</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2FincomingPumpHandler%3AhandleMessage">RocheDriver/RocheDriver/incomingPumpHandler:handleMessage</a><br><br>public <a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothAdapter">BluetoothAdapter</a> bt;<br>written by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3AonCreate">RocheDriver/RocheDriver:onCreate</a><br>used by:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AsendTransportLayerCommand">RocheData/Transport:sendTransportLayerCommand</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AonCreateView">RocheDriver/DiscoveryFragment:onCreateView</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AresetDriver">RocheDriver/Driver:resetDriver</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3AonCreate">RocheDriver/RocheDriver:onCreate</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3ArestoreDevice">RocheDriver/RocheDriver:restoreDevice</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2Fconnect%3Arun">RocheDriver/RocheDriver/connect:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2FbtReceiver%3AonReceive">RocheDriver/RocheDriver/btReceiver:onReceive</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2FincommingPumpHandler%3AhandleMessage">RocheDriver/RocheDriver/incommingPumpHandler:handleMessage</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AonCreateView">RocheDriver/SetupFragment:onCreateView</a><br><br>public static <a class="tc-tiddlylink tc-tiddlylink-missing" href="#BluetoothConn">BluetoothConn</a> remotePumpBt = null;<br>written by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AresetDriver">RocheDriver/Driver:resetDriver</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3AonDestroy">RocheDriver/RocheDriver:onDestroy</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3ArestoreDevice">RocheDriver/RocheDriver:restoreDevice</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2FincommingPumpHandler%3AhandleMessage">RocheDriver/RocheDriver/incommingPumpHandler:handleMessage</a><br>read by:<br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheData%2FApplication%3ArunSystem">RocheData/Application:runSystem</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AstartTransmitThread">RocheData/Transport:startTransmitThread</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AonCreateView">RocheDriver/DiscoveryFragment:onCreateView</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDiscoveryFragment%3AupdateUI">RocheDriver/DiscoveryFragment:updateUI</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FDriver%3AresetDriver">RocheDriver/Driver:resetDriver</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3AonDestroy">RocheDriver/RocheDriver:onDestroy</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%3ArestoreDevice">RocheDriver/RocheDriver:restoreDevice</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2Fconnect%3Arun">RocheDriver/RocheDriver/connect:run</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FRocheDriver%2FincommingPumpHandler%3AhandleMessage">RocheDriver/RocheDriver/incommingPumpHandler:handleMessage</a><br><a class="tc-tiddlylink tc-tiddlylink-missing" href="#RocheDriver%2FSetupFragment%3AupdateUI">RocheDriver/SetupFragment:updateUI</a><br><br>public static Queue&lt;byte[]&gt; pumpMessages;<br>written by:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData%3AInterfaceData">RocheDriver/InterfaceData:InterfaceData</a><br>read by:<br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheData%2FTransport%3AstartReceiveThread">RocheData/Transport:startReceiveThread</a><br><a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FBluetoothConn%2FRunningThread%3Arun">RocheDriver/BluetoothConn/RunningThread:run</a></p></div>


</div>


</a><a name="RocheDriver/InterfaceData:getInstance">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/InterfaceData:getInstance
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 7:51pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>if(instance == null)<br>		{<br>			synchronized(<a class="tc-tiddlylink tc-tiddlylink-missing" href="#InterfaceData">InterfaceData</a>.class)<br>			{<br>				if(instance == null)<br>					instance = new <a class="tc-tiddlylink tc-tiddlylink-resolves" href="#RocheDriver%2FInterfaceData%3AInterfaceData">RocheDriver/InterfaceData:InterfaceData</a>();<br>			}<br>		}<br>		return instance;</p></div>


</div>


</a><a name="RocheDriver/InterfaceData:InterfaceData">
<div class="tc-tiddler-frame tc-tiddler-view-frame tc-tiddler-exists   "><div class="tc-tiddler-title">
<div class="tc-titlebar">
<span class="tc-tiddler-controls">
<span class=" tc-reveal"><button aria-label="more" class="tc-btn-invisible" title="More actions">


</button><div class=" tc-reveal" hidden="true"></div></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="edit" class="tc-btn-invisible" title="Edit this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal"><button aria-label="close" class="tc-btn-invisible" title="Close this tiddler">


</button></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span><span class=" tc-reveal" hidden="true"></span>
</span>

<span>

<span class="tc-tiddler-title-icon" style="fill:;">

</span>



<h2 class="tc-title">
RocheDriver/InterfaceData:InterfaceData
</h2>

</span>

</div>

<div class="tc-tiddler-info tc-popup-handle tc-reveal" hidden="true"></div>
</div><div class=" tc-reveal" hidden="true"></div>
<div class=" tc-reveal">
<div class="tc-subtitle">
<a class="tc-tiddlylink tc-tiddlylink-missing" href="#">

</a> 29th April 2017 at 7:47pm
</div>
</div>
<div class=" tc-reveal">
<div class="tc-tags-wrapper"></div>
</div>
<div class="tc-tiddler-body tc-reveal"><p>Code:<br>pumpMessages = new <a class="tc-tiddlylink tc-tiddlylink-missing" href="#ConcurrentLinkedQueue">ConcurrentLinkedQueue</a>&lt;byte[]&gt;();</p></div>


</div>


</a>

</p>
</section>
</body>
</html>
